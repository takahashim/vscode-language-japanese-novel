{"version":3,"sources":[".././node_modules/node-gyp-build/index.js",".././extension.ts",".././node_modules/utf-8-validate/fallback.js",".././node_modules/utf-8-validate/index.js",".././node_modules/ws/index.js",".././node_modules/ws/lib/buffer-util.js",".././node_modules/ws/lib/constants.js",".././node_modules/ws/lib/event-target.js",".././node_modules/ws/lib/extension.js",".././node_modules/ws/lib/limiter.js",".././node_modules/ws/lib/permessage-deflate.js",".././node_modules/ws/lib/receiver.js",".././node_modules/ws/lib/sender.js",".././node_modules/ws/lib/stream.js",".././node_modules/ws/lib/validation.js",".././node_modules/ws/lib/websocket-server.js",".././node_modules/ws/lib/websocket.js","../external \"child_process\"","../external \"crypto\"","../external \"events\"","../external \"fs\"","../external \"http\"","../external \"https\"","../external \"net\"","../external \"os\"","../external \"path\"","../external \"stream\"","../external \"tls\"","../external \"url\"","../external \"vscode\"","../external \"zlib\"","../webpack/bootstrap","../webpack/startup"],"names":["fs","path","os","runtimeRequire","vars","process","config","variables","prebuildsOnly","env","PREBUILDS_ONLY","abi","versions","modules","runtime","electron","ELECTRON_RUN_AS_NODE","window","type","arch","platform","libc","LIBC","existsSync","isAlpine","armv","ARM_VERSION","arm_version","uv","split","load","dir","readdirSync","err","getFirst","filter","files","join","matchBuild","name","test","parseTags","file","arr","tags","specificity","pop","i","length","tag","napi","slice","matchTags","runtimeAgnostic","compareTags","a","b","module","exports","resolve","toUpperCase","replace","release","debug","prebuild","nearby","dirname","execPath","target","node","Boolean","Error","prebuilds","winner","map","sort","__createBinding","this","Object","create","o","m","k","k2","undefined","defineProperty","enumerable","get","__setModuleDefault","v","value","__importStar","mod","__esModule","result","prototype","hasOwnProperty","call","vscode","cp","myeditor","activeTextEditor","output","createOutputChannel","html","launchserver","origineditor","createServer","request","response","writeHead","end","listen","s","wsserver","port","on","ws","message","console","log","getConfig","send","JSON","stringify","editorText","workspace","onDidChangeTextDocument","e","_a","document","publishwebsocketsdelay","presskey","onDidChangeTextEditorSelection","textEditor","onDidChangeConfiguration","clients","forEach","client","getConfiguration","lineheightrate","fontfamily","fontsize","numfontsize","parseInt","exec","unitoffontsize","linelength","linesperpage","pagewidth","pageheight","lineheight","keypressflag","publish","socketserver","publishwebsockets","timeoutID","updatecounter","Math","ceil","getText","self","setTimeout","cancel","clearTimeout","verticalpreview","createWebviewPanel","ViewColumn","Two","enableScripts","webview","exportpdf","myhtml","folderPath","workspaceFolders","uri","fsPath","mypath","myworkingdirectory","vivliocommand","escapedpath","escapeddirectory","appendLine","writeFile","stdout","stderr","taggedHTML","userregex","text","cursorOffset","offsetAt","selection","anchor","myHTML","paragraph","match","Array","element","index","thismatch","RegExp","thisreplace","activate","context","subscriptions","push","commands","registerCommand","readFileSync","extensionPath","deactivate","buf","len","__dirname","WebSocket","createWebSocketStream","Server","Receiver","Sender","EMPTY_BUFFER","concat","list","totalLength","Buffer","allocUnsafe","offset","set","_mask","source","mask","_unmask","buffer","toArrayBuffer","byteLength","byteOffset","toBuffer","data","readOnly","isBuffer","ArrayBuffer","from","isView","bufferUtil","bu","BufferUtil","unmask","BINARY_TYPES","GUID","kStatusCode","Symbol","kWebSocket","alloc","NOOP","Event","MessageEvent","super","CloseEvent","code","reason","wasClean","_closeFrameReceived","_closeFrameSent","OpenEvent","ErrorEvent","error","EventTarget","listener","options","onMessage","onClose","onError","onOpen","method","once","_listener","listeners","removeListener","tokenChars","dest","elem","format","extensions","keys","extension","configurations","isArray","params","values","parse","header","offers","extensionName","paramName","mustUnescape","isEscaping","inQuotes","start","charCodeAt","SyntaxError","token","kDone","kRun","concurrency","pending","Infinity","jobs","job","shift","zlib","Limiter","TRAILER","kPerMessageDeflate","kTotalLength","kCallback","kBuffers","kError","zlibLimiter","deflateOnData","chunk","inflateOnData","_maxPayload","RangeError","reset","inflateOnError","_inflate","isServer","maxPayload","_options","_threshold","threshold","_isServer","_deflate","concurrencyLimit","serverNoContextTakeover","server_no_context_takeover","clientNoContextTakeover","client_no_context_takeover","serverMaxWindowBits","server_max_window_bits","clientMaxWindowBits","client_max_window_bits","normalizeParams","acceptAsServer","acceptAsClient","close","callback","opts","accepted","find","key","num","Number","isInteger","TypeError","fin","add","done","_decompress","_compress","endpoint","windowBits","Z_DEFAULT_WINDOWBITS","createInflateRaw","zlibInflateOptions","write","flush","_readableState","endEmitted","createDeflateRaw","zlibDeflateOptions","Z_SYNC_FLUSH","Writable","PerMessageDeflate","isValidStatusCode","isValidUTF8","ErrorCtor","prefix","statusCode","captureStackTrace","binaryType","_binaryType","_extensions","_bufferedBytes","_buffers","_compressed","_payloadLength","_fragmented","_masked","_fin","_opcode","_totalPayloadLength","_messageLength","_fragments","_state","_loop","encoding","cb","startLoop","n","dst","Uint8Array","getInfo","getPayloadLength16","getPayloadLength64","getMask","getData","consume","compressed","haveLength","readUInt16BE","readUInt32BE","pow","controlMessage","decompress","dataMessage","er","messageLength","fragments","emit","toString","randomFillSync","applyMask","socket","_socket","_firstFragment","_deflating","_queue","merge","payloadLength","opcode","rsv1","writeUInt16BE","writeUInt32BE","enqueue","doClose","sendFrame","frame","doPing","doPong","perMessageDeflate","binary","compress","dispatch","_","destroyed","dequeue","Reflect","apply","cork","uncork","Duplex","emitClose","stream","duplexOnEnd","_writableState","finished","destroy","duplexOnError","listenerCount","resumeOnReceiverDrain","receiverOnDrain","resume","readyState","CONNECTING","_receiver","removeAllListeners","duplex","autoDestroy","objectMode","writableObjectMode","msg","pause","_destroy","CLOSED","nextTick","called","terminate","_final","_read","OPEN","needDrain","_write","_isValidUTF8","Validation","EventEmitter","createHash","STATUS_CODES","keyRegex","server","socketOnError","abortHandshake","headers","writable","Connection","h","handleProtocols","clientTracking","verifyClient","noServer","backlog","host","_server","req","res","body","emitConnection","bind","_removeListeners","event","addListeners","listening","upgrade","head","handleUpgrade","Set","address","url","indexOf","trim","version","toLowerCase","shouldHandle","accept","info","origin","secure","authorized","encrypted","verified","completeUpgrade","readable","update","digest","protocol","_protocol","setSocket","delete","https","http","net","tls","randomBytes","URL","addEventListener","removeEventListener","readyStates","protocolVersions","protocols","_closeCode","_closeMessage","_closeTimer","_readyState","_sender","_bufferedAmount","_redirects","initAsClient","includes","_url","receiver","receiverOnConclude","receiverOnError","receiverOnMessage","receiverOnPing","receiverOnPong","setNoDelay","unshift","socketOnClose","socketOnData","socketOnEnd","cleanup","_req","CLOSING","ping","sendAfterClose","pong","websocket","protocolVersion","followRedirects","maxRedirects","createConnection","socketPath","hostname","timeout","parsedUrl","href","isUnixSocket","pathname","isSecure","defaultPort","tlsConnect","netConnect","startsWith","Upgrade","search","handshakeTimeout","offer","Origin","username","password","auth","parts","aborted","location","abort","addr","serverProt","protList","protError","connect","servername","isIP","setHeader","receiverOnFinish","read","errorEmitted","descriptor","property","configurable","require","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"mappings":"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","file":"extension.js","sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar os = require('os')\n\n// Workaround to fix webpack's build warnings: 'the request of a dependency is an expression'\nvar runtimeRequire = typeof __webpack_require__ === 'function' ? __non_webpack_require__ : require // eslint-disable-line\n\nvar vars = (process.config && process.config.variables) || {}\nvar prebuildsOnly = !!process.env.PREBUILDS_ONLY\nvar abi = process.versions.modules // TODO: support old node where this is undef\nvar runtime = isElectron() ? 'electron' : 'node'\nvar arch = os.arch()\nvar platform = os.platform()\nvar libc = process.env.LIBC || (isAlpine(platform) ? 'musl' : 'glibc')\nvar armv = process.env.ARM_VERSION || (arch === 'arm64' ? '8' : vars.arm_version) || ''\nvar uv = (process.versions.uv || '').split('.')[0]\n\nmodule.exports = load\n\nfunction load (dir) {\n  return runtimeRequire(load.path(dir))\n}\n\nload.path = function (dir) {\n  dir = path.resolve(dir || '.')\n\n  try {\n    var name = runtimeRequire(path.join(dir, 'package.json')).name.toUpperCase().replace(/-/g, '_')\n    if (process.env[name + '_PREBUILD']) dir = process.env[name + '_PREBUILD']\n  } catch (err) {}\n\n  if (!prebuildsOnly) {\n    var release = getFirst(path.join(dir, 'build/Release'), matchBuild)\n    if (release) return release\n\n    var debug = getFirst(path.join(dir, 'build/Debug'), matchBuild)\n    if (debug) return debug\n  }\n\n  var prebuild = resolve(dir)\n  if (prebuild) return prebuild\n\n  var nearby = resolve(path.dirname(process.execPath))\n  if (nearby) return nearby\n\n  var target = [\n    'platform=' + platform,\n    'arch=' + arch,\n    'runtime=' + runtime,\n    'abi=' + abi,\n    'uv=' + uv,\n    armv ? 'armv=' + armv : '',\n    'libc=' + libc,\n    'node=' + process.versions.node,\n    (process.versions && process.versions.electron) ? 'electron=' + process.versions.electron : '',\n    typeof __webpack_require__ === 'function' ? 'webpack=true' : '' // eslint-disable-line\n  ].filter(Boolean).join(' ')\n\n  throw new Error('No native build was found for ' + target + '\\n    loaded from: ' + dir + '\\n')\n\n  function resolve (dir) {\n    // Find most specific flavor first\n    var prebuilds = path.join(dir, 'prebuilds', platform + '-' + arch)\n    var parsed = readdirSync(prebuilds).map(parseTags)\n    var candidates = parsed.filter(matchTags(runtime, abi))\n    var winner = candidates.sort(compareTags(runtime))[0]\n    if (winner) return path.join(prebuilds, winner.file)\n  }\n}\n\nfunction readdirSync (dir) {\n  try {\n    return fs.readdirSync(dir)\n  } catch (err) {\n    return []\n  }\n}\n\nfunction getFirst (dir, filter) {\n  var files = readdirSync(dir).filter(filter)\n  return files[0] && path.join(dir, files[0])\n}\n\nfunction matchBuild (name) {\n  return /\\.node$/.test(name)\n}\n\nfunction parseTags (file) {\n  var arr = file.split('.')\n  var extension = arr.pop()\n  var tags = { file: file, specificity: 0 }\n\n  if (extension !== 'node') return\n\n  for (var i = 0; i < arr.length; i++) {\n    var tag = arr[i]\n\n    if (tag === 'node' || tag === 'electron' || tag === 'node-webkit') {\n      tags.runtime = tag\n    } else if (tag === 'napi') {\n      tags.napi = true\n    } else if (tag.slice(0, 3) === 'abi') {\n      tags.abi = tag.slice(3)\n    } else if (tag.slice(0, 2) === 'uv') {\n      tags.uv = tag.slice(2)\n    } else if (tag.slice(0, 4) === 'armv') {\n      tags.armv = tag.slice(4)\n    } else if (tag === 'glibc' || tag === 'musl') {\n      tags.libc = tag\n    } else {\n      continue\n    }\n\n    tags.specificity++\n  }\n\n  return tags\n}\n\nfunction matchTags (runtime, abi) {\n  return function (tags) {\n    if (tags == null) return false\n    if (tags.runtime !== runtime && !runtimeAgnostic(tags)) return false\n    if (tags.abi !== abi && !tags.napi) return false\n    if (tags.uv && tags.uv !== uv) return false\n    if (tags.armv && tags.armv !== armv) return false\n    if (tags.libc && tags.libc !== libc) return false\n\n    return true\n  }\n}\n\nfunction runtimeAgnostic (tags) {\n  return tags.runtime === 'node' && tags.napi\n}\n\nfunction compareTags (runtime) {\n  // Precedence: non-agnostic runtime, abi over napi, then by specificity.\n  return function (a, b) {\n    if (a.runtime !== b.runtime) {\n      return a.runtime === runtime ? -1 : 1\n    } else if (a.abi !== b.abi) {\n      return a.abi ? -1 : 1\n    } else if (a.specificity !== b.specificity) {\n      return a.specificity > b.specificity ? -1 : 1\n    } else {\n      return 0\n    }\n  }\n}\n\nfunction isElectron () {\n  if (process.versions && process.versions.electron) return true\n  if (process.env.ELECTRON_RUN_AS_NODE) return true\n  return typeof window !== 'undefined' && window.process && window.process.type === 'renderer'\n}\n\nfunction isAlpine (platform) {\n  return platform === 'linux' && fs.existsSync('/etc/alpine-release')\n}\n\n// Exposed for unit tests\n// TODO: move to lib\nload.parseTags = parseTags\nload.matchTags = matchTags\nload.compareTags = compareTags\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar vscode = __importStar(require(\"vscode\"));\nvar fs = require('fs');\nvar path = require('path');\nvar cp = require('child_process');\nvar myeditor = vscode.window.activeTextEditor;\nvar output = vscode.window.createOutputChannel(\"Novel\");\nvar html = \"\";\n//\nfunction activate(context) {\n    context.subscriptions.push(vscode.commands.registerCommand('Novel.vertical-preview', verticalpreview));\n    context.subscriptions.push(vscode.commands.registerCommand('Novel.export-pdf', exportpdf));\n    context.subscriptions.push(vscode.commands.registerCommand('Novel.launch-preview-server', launchserver));\n    html = fs.readFileSync(path.join(context.extensionPath, 'htdocs', 'index.html'));\n}\nfunction launchserver(origineditor) {\n    //\n    //https://sasaplus1.hatenadiary.com/entry/20121129/1354198092 \n    // Node http server\n    var http = require('http');\n    //    const folderPath = vscode.workspace.workspaceFolders[0].uri.fsPath;\n    //    const html = fs.readFileSync(path.join(folderPath, 'htdocs/index.html'));\n    var viwerserver = http.createServer(function (request, response) {\n        response.writeHead(200, {\n            'Content-Type': 'text/html',\n            'Cache-Control': 'private, max-age=0'\n        });\n        response.end(html);\n    });\n    viwerserver.listen(8080);\n    // Node Websockets Server\n    var wsserver = require(\"ws\").Server;\n    var s = new wsserver({ port: 5001 });\n    s.on(\"connection\", function (ws) {\n        //console.log(previewvariables());\n        ws.on(\"message\", function (message) {\n            console.log(\"Received: \" + message);\n            console.log(getConfig());\n            if (message === \"hello\") {\n                ws.send(JSON.stringify(getConfig()));\n                //ws.send( editorText());\n            }\n            else if (message === \"givemedata\") {\n                console.log(\"sending body\");\n                ws.send(editorText(origineditor));\n            }\n        });\n    });\n    vscode.workspace.onDidChangeTextDocument(function (e) {\n        var _a;\n        if (e.document == ((_a = vscode.window.activeTextEditor) === null || _a === void 0 ? void 0 : _a.document)) {\n            publishwebsocketsdelay.presskey(s);\n        }\n    });\n    vscode.window.onDidChangeTextEditorSelection(function (e) {\n        if (e.textEditor == vscode.window.activeTextEditor) {\n            publishwebsocketsdelay.presskey(s);\n        }\n    });\n    vscode.workspace.onDidChangeConfiguration(function (e) {\n        //\n        console.log('setting changed');\n        sendsettingwebsockets(s);\n    });\n    publishwebsocketsdelay.presskey(s);\n    return s;\n}\nfunction publishwebsockets(socketserver) {\n    socketserver.clients.forEach(function (client) {\n        client.send(editorText(\"active\"));\n    });\n}\nfunction sendsettingwebsockets(socketserver) {\n    socketserver.clients.forEach(function (client) {\n        client.send((JSON.stringify(getConfig())));\n    });\n}\nfunction getConfig() {\n    var config = vscode.workspace.getConfiguration('Novel');\n    var lineheightrate = 1.75;\n    var fontfamily = config.get('preview.font-family');\n    var fontsize = config.get('preview.fontsize');\n    var numfontsize = parseInt(/(\\d+)(\\D+)/.exec(fontsize)[1]);\n    var unitoffontsize = /(\\d+)(\\D+)/.exec(fontsize)[2];\n    var linelength = config.get('preview.linelength');\n    var linesperpage = config.get('preview.linesperpage');\n    var pagewidth = (linesperpage * numfontsize * lineheightrate * 1.003) + unitoffontsize;\n    var pageheight = (linelength * numfontsize) + unitoffontsize;\n    var lineheight = (numfontsize * lineheightrate) + unitoffontsize;\n    var previewsettings = {\n        lineheightrate: lineheightrate,\n        fontfamily: fontfamily,\n        fontsize: fontsize,\n        numfontsize: numfontsize,\n        unitoffontsize: unitoffontsize,\n        linelength: linelength,\n        linesperpage: linesperpage,\n        pagewidth: pagewidth,\n        pageheight: pageheight,\n        lineheight: lineheight,\n    };\n    return previewsettings;\n}\nvar keypressflag = false;\nvar publishwebsocketsdelay = {\n    publish: function (socketserver) {\n        publishwebsockets(socketserver);\n        keypressflag = false;\n        delete this.timeoutID;\n    },\n    presskey: function (s) {\n        //this.cancel();\n        if (!keypressflag) {\n            var updatecounter = Math.ceil(vscode.window.activeTextEditor.document.getText().length / 10);\n            var self = this;\n            var socketserver = s;\n            var timer = timer;\n            this.timeoutID = setTimeout(function (socketserver) {\n                self.publish(socketserver);\n            }, updatecounter, socketserver);\n            keypressflag = true;\n        }\n    },\n    cancel: function () {\n        if (typeof this.timeoutID == \"number\") {\n            window.clearTimeout(this.timeoutID);\n            delete this.timeoutID;\n        }\n    },\n};\nfunction verticalpreview() {\n    var origineditor = vscode.window.activeTextEditor;\n    var s = launchserver(origineditor);\n    //    vscode.window.showInformationMessage('Hello, world!');\n    var panel = vscode.window.createWebviewPanel('preview', // Identifies the type of the webview. Used internally\n    '', // Title of the panel displayed to the user\n    vscode.ViewColumn.Two, // Editor column to show the new webview panel in.\n    {\n        enableScripts: true,\n    } // Webview options. More on these later.\n    );\n    /*     vscode.workspace.onDidChangeTextDocument((e) => {\n            var _a;\n            if (e.document == ((_a = vscode.window.activeTextEditor) === null || _a === void 0 ? void 0 : _a.document)) {\n                panel.webview.html = getWebviewContent();\n            }\n        });\n    \n        vscode.window.onDidChangeTextEditorSelection((e) => {\n            if (e.textEditor == vscode.window.activeTextEditor) {\n                panel.webview.html = getWebviewContent();\n            }\n        });\n     */\n    // And set its HTML content\n    //panel.webview.html = getWebviewContent();\n    panel.webview.html = \"\\n    <html>\\n        <head>\\n            <style>\\n            body{\\n                width:100vw;\\n                height:100vh;\\n                overflor:hidden;\\n            }\\n            </style>\\n        </head>\\n        <body>\\n            <iframe src=\\\"http://localhost:8080\\\" frameBorder=\\\"0\\\" style=\\\"min-width: 100%; min-height: 100%\\\" />\\n        </body>\\n    </html>\";\n}\nfunction exportpdf() {\n    var myhtml = getWebviewContent();\n    //console.log(myhtml);\n    var folderPath = vscode.workspace.workspaceFolders[0].uri.fsPath;\n    var mypath = path.join(folderPath, 'publish.html');\n    var myworkingdirectory = path.join(folderPath, '');\n    var vivliocommand = 'vivliostyle build ';\n    var escapedpath = mypath;\n    escapedpath = escapedpath.replace(/ /g, '\\\\ ');\n    var escapeddirectory = myworkingdirectory;\n    escapeddirectory = escapeddirectory.replace(/ /g, '\\\\ ');\n    output.appendLine(\"startig to publish: \" + escapedpath);\n    vivliocommand = vivliocommand + escapedpath + ' -o ' + escapeddirectory + \"/output.pdf\";\n    output.appendLine(\"startig to publish: \" + vivliocommand);\n    fs.writeFile(mypath, myhtml, function (err) {\n        if (err) {\n            console.log(err);\n        }\n        ;\n        //https://docs.vivliostyle.org/#/ja/vivliostyle-cli\n        output.appendLine(\"saving pdf to \" + vivliocommand);\n        cp.exec(vivliocommand, function (err, stdout, stderr) {\n            if (err) {\n                console.log(\"stderr: \" + stderr);\n                output.appendLine(\"stderr: \" + stderr);\n                return;\n            }\n            output.appendLine(\"stdout: \" + stdout);\n            output.appendLine('PDF');\n        });\n        output.appendLine('HTML');\n    });\n}\nfunction deactivate() {\n    return undefined;\n}\nmodule.exports = { activate: activate, deactivate: deactivate };\nfunction editorText(origineditor) {\n    if (origineditor === \"active\") {\n        myeditor = vscode.window.activeTextEditor;\n    }\n    else {\n        myeditor = origineditor;\n    }\n    var text = myeditor.document.getText();\n    var cursorOffset = myeditor ? myeditor.document.offsetAt(myeditor.selection.anchor) : 0;\n    var myHTML = \"\";\n    var cursorTaggedHtml = \"\";\n    // \n    if (text.slice(cursorOffset, cursorOffset + 1) == '\\n') {\n        cursorTaggedHtml = text.slice(0, cursorOffset) + '<span id=\"cursor\"></span>' + text.slice(cursorOffset);\n    }\n    else {\n        cursorTaggedHtml = text.slice(0, cursorOffset) + '<span id=\"cursor\">' + text.slice(cursorOffset, cursorOffset + 1) + '</span>' + text.slice(cursorOffset + 1);\n    }\n    var paragraphs = cursorTaggedHtml.split('\\n');\n    //console.log(paragraphs);\n    paragraphs.forEach(function (paragraph) {\n        //console.log(paragraph);\n        if (paragraph.match(/^\\s*$/)) {\n            myHTML += '<p class=\"blank\">_' + paragraph + '</p>';\n        }\n        else if (paragraph.match(/^<span id=\"cursor\">$/) || paragraph.match(/^<\\/span>$/)) {\n            myHTML += '<p class=\"blank\">_</p><span id=\"cursor\">';\n        }\n        else {\n            myHTML += '<p>' + paragraph + '</p>';\n        }\n    });\n    return markUpHtml(myHTML);\n}\nfunction markUpHtml(myhtml) {\n    var taggedHTML = myhtml;\n    //configuration \n    var config = vscode.workspace.getConfiguration('Novel');\n    var userregex = new Array(0);\n    userregex = config.get('preview.userregex');\n    //    console.log(userregex, userregex.length);\n    if (userregex.length > 0) {\n        userregex.forEach(function (element, index) {\n            //if ( thismatch && thisreplace ){\n            var thismatch = new RegExp(element[0], 'gi');\n            var thisreplace = element[1];\n            //    console.log(element[0], thismatch, thisreplace);\n            taggedHTML = taggedHTML.replace(thismatch, thisreplace);\n            //}\n        });\n    }\n    taggedHTML = taggedHTML.replace(/<p>[1]<\\/p>/g, '<div class=\"indent-1\">');\n    taggedHTML = taggedHTML.replace(/<p>[2]<\\/p>/g, '<div class=\"indent-2\">');\n    taggedHTML = taggedHTML.replace(/<p>[3]<\\/p>/g, '<div class=\"indent-3\">');\n    taggedHTML = taggedHTML.replace(/<p><\\/p>/g, '</div>');\n    taggedHTML = taggedHTML.replace(/<!-- (.+?) -->/g, '<span class=\"comment\"><span class=\"commentbody\">$1</span></span>');\n    taggedHTML = taggedHTML.replace(/([^\\n]+?)([^]+?)/g, '<ruby>$1<rt>$2</rt></ruby>');\n    taggedHTML = taggedHTML.replace(/([--]+?)(.+?)/g, '<ruby>$1<rt>$2</rt></ruby>');\n    taggedHTML = taggedHTML.replace(/(.+?)\\1/g, '<em class=\"side-dot\">$1</em>');\n    /*     s.clients.forEach(client => {\n            //client.send(previewvariables());\n            client.send(taggedHTML);\n        });\n     */\n    return taggedHTML;\n}\nfunction getWebviewContent() {\n    //configuration \n    var config = vscode.workspace.getConfiguration('Novel');\n    var lineheightrate = 1.75;\n    var fontfamily = config.get('preview.font-family');\n    var fontsize = config.get('preview.fontsize');\n    var numfontsize = parseInt(/(\\d+)(\\D+)/.exec(fontsize)[1]);\n    var unitoffontsize = /(\\d+)(\\D+)/.exec(fontsize)[2];\n    var linelength = config.get('preview.linelength');\n    var linesperpage = config.get('preview.linesperpage');\n    var pagewidth = (linesperpage * numfontsize * lineheightrate * 1.003) + unitoffontsize;\n    var pageheight = (linelength * numfontsize) + unitoffontsize;\n    var lineheight = (numfontsize * lineheightrate) + unitoffontsize;\n    var mytext = editorText(\"active\");\n    return \"<!DOCTYPE html>\\n  <html lang=\\\"ja\\\">\\n  <head>\\n      <meta charset=\\\"UTF-8\\\">\\n      <meta name=\\\"viewport\\\" content=\\\"width=device-width, initial-scale=1.0\\\">\\n      <title>Cat Coding</title>\\n\\n      <style>\\n      @charset \\\"UTF-8\\\";\\n      html {\\n      /* \\u7D44\\u307F\\u65B9\\u5411 */\\n      -epub-writing-mode: vertical-rl;\\n      -ms-writing-mode: tb-rl;\\n      writing-mode: vertical-rl;\\n  \\n      orphans: 1;\\n      widows: 1;\\n      }\\n  \\n      * {\\n      margin: 0;\\n      padding: 0;\\n      }\\n  \\n      @page {\\n      size: 105mm 148mm;\\n      width: 88mm;\\n      /*  width: calc(84mm - 1q); */\\n      height: 110mm;\\n      margin-top: 20mm;\\n      margin-bottom: auto;\\n      margin-left: auto;\\n      margin-right: auto;\\n      /* \\u4EE5\\u4E0B\\u3001\\u30DE\\u30FC\\u30B8\\u30F3\\u30DC\\u30C3\\u30AF\\u30B9\\u306B\\u7D99\\u627F\\u3055\\u308C\\u308B */\\n      font-size: 6pt;\\n      font-family: \\\"\\u6E38\\u660E\\u671D\\\", \\\"YuMincho\\\", serif;\\n      /* \\u672C\\u6765\\u4E0D\\u8981\\uFF08<span class=\\\"smaller\\\"><span class=\\\"smaller\\\">\\u30EB\\u30FC\\u30C8\\u8981\\u7D20\\u306E\\u6307\\u5B9A\\u304C\\u7D99\\u627F\\u3055\\u308C\\u308B</span></span>\\uFF09\\u3060\\u304C\\u3001\\u73FE\\u6642\\u70B9\\u306Evivliostyle.js\\u306E\\u5236\\u9650\\u306B\\u3088\\u308A\\u5FC5\\u8981 */\\n      vertical-align: top;\\n      }\\n  \\n      @page :left {\\n      margin-right: 10mm;\\n      @top-left {\\n          content: counter(page) \\\"  <$projecttitle>\\\";\\n          margin-left: 12q;\\n          margin-top: 135mm;\\n          writing-mode: horizontal-tb;\\n          /* CSS\\u4ED5\\u69D8\\u4E0A\\u306F@page\\u30EB\\u30FC\\u30EB\\u5185\\u306B\\u66F8\\u3051\\u3070\\u3088\\u3044\\u304C\\u3001\\u73FE\\u6642\\u70B9\\u306Evivliostyle.js\\u306E\\u5236\\u9650\\u306B\\u3088\\u308A\\u3053\\u3053\\u306B\\u66F8\\u304F */\\n      }\\n      }\\n      @page :right {\\n      margin-right: 14mm;\\n      /* border-bottom: 1pt solid black; */\\n      /* \\u53F3\\u4E0B\\u30CE\\u30F3\\u30D6\\u30EB */\\n      @top-right {\\n          content: \\\"<$fullname>\\u3000 \\\"counter(page);\\n          margin-right: 12q;\\n          margin-top: 135mm;\\n          writing-mode: horizontal-tb;\\n          /* CSS\\u4ED5\\u69D8\\u4E0A\\u306F@page\\u30EB\\u30FC\\u30EB\\u5185\\u306B\\u66F8\\u3051\\u3070\\u3088\\u3044\\u304C\\u3001\\u73FE\\u6642\\u70B9\\u306Evivliostyle.js\\u306E\\u5236\\u9650\\u306B\\u3088\\u308A\\u3053\\u3053\\u306B\\u66F8\\u304F */\\n      }\\n      }\\n  \\n      html {\\n      font-family: \\\"\\u6E38\\u660E\\u671D\\\", \\\"YuMincho\\\", serif;\\n      font-weight: Medium;\\n      text-align: justify;\\n      }\\n  \\n      body{\\n      }\\n  \\n      h1 {\\n      /* \\u30D5\\u30A9\\u30F3\\u30C8 */\\n      font-weight: Extrabold;\\n      /* \\u30D5\\u30A9\\u30F3\\u30C8\\u30B5\\u30A4\\u30BA */\\n      font-size: 24q;\\n      /* \\u5B57\\u4E0B\\u3052 */\\n      text-indent: 0;\\n      /* \\u76F4\\u5F8C\\u306E\\u6539\\u30DA\\u30FC\\u30B8\\u30FB\\u6539\\u6BB5\\u7981\\u6B62 */\\n      page-break-before: always;\\n      page-break-after: always;\\n      line-height: 42q;\\n      letter-spacing: 0.25em;\\n      display: flex;\\n      align-items: center;\\n      }\\n  \\n      h2 {\\n      /* \\u30D5\\u30A9\\u30F3\\u30C8 */\\n      font-weight: Demibold;\\n      /* \\u30D5\\u30A9\\u30F3\\u30C8\\u30B5\\u30A4\\u30BA */\\n      font-size: 16q;\\n      /* \\u5B57\\u4E0B\\u3052 */\\n      text-indent: 3em;\\n      /* \\u76F4\\u5F8C\\u306E\\u6539\\u30DA\\u30FC\\u30B8\\u30FB\\u6539\\u6BB5\\u7981\\u6B62 */\\n      page-break-before: always;\\n      page-break-after: avoid;\\n      line-height: 42q;\\n      margin-left: 2em;\\n      }\\n  \\n      h2.part {\\n      width: 80mm;\\n      padding: 0mm 35mm;\\n      font-weight: bold;\\n      font-size: 16q;\\n      page-break-before: always;\\n      page-break-after: always;\\n      margin-left: 4em;\\n      }\\n  \\n      h1 + h2 {\\n      margin-right: 16pt;\\n      }\\n  \\n      ruby > rt {\\n      font-size: 6.5q;\\n      }\\n  \\n      p {\\n        font-size: calc(110mm / \" + linelength + \");\\n        line height: 1.65;\\n        text-indent: 0em;\\n        hanging-punctuation: force-end;\\n        line-break:strict;\\n        page-break-inside: auto;\\n    }\\n \\n      div.indent-1 p:first-of-type, div.indent-2 p:first-of-type, div.indent-3 p:first-of-type{\\n        padding-block-start: calc( \" + fontsize + \" * \" + lineheightrate + \");\\n        }\\n\\n        div.indent-1 p:last-of-type, div.indent-2 p:last-of-type, div.indent-3 p:last-of-type{\\n        padding-block-end: calc( \" + fontsize + \" * \" + lineheightrate + \");\\n        }\\n\\n    \\n    div.indent-1 p{\\n    height: calc( 110mm - (\" + fontsize + \"));\\n    padding-top: \" + fontsize + \";\\n    }\\n\\n    div.indent-2 p{\\n    height: calc( 110mm - (\" + fontsize + \" * 2));\\n    padding-top: calc(\" + fontsize + \" * 2);\\n    }\\n\\n    div.indent-3 p{\\n    height: calc( 110mm - (\" + fontsize + \" * 3));\\n    padding-top: calc(\" + fontsize + \" * 3);\\n    }\\n\\n        p.goth {\\n        margin-top: 3em;\\n        font-family: \\\"\\u6E38\\u30B4\\u30B7\\u30C3\\u30AF\\\", \\\"YuGothic\\\", san-serif;\\n        margin-block-start: 1em;\\n        margin-block-end: 1em;\\n        }\\n  \\n        p.align-rb {\\n        text-align: right;\\n        }\\n\\n        p.goth + p.goth {\\n        margin-block-start: -1em;\\n        }\\n\\n        div.codes {\\n        display: inline-block;\\n        margin: 3em 1em;\\n        writing-mode: horizontal-tb;\\n        padding: 1em;\\n        font-family: \\\"Courier\\\", monospace;\\n        font-size: 0.8em;\\n        }\\n  \\n      div.codes p {\\n      text-orientation: sideways;\\n      }\\n  \\n      p.star {\\n      text-indent: 3em;\\n      margin-right: 16pt;\\n      margin-left: 16pt;\\n      }\\n  \\n      hr {\\n      border: none;\\n      border-right: 1pt solid black;\\n      height: 6em;\\n      margin: auto 8.5pt;\\n      }\\n  \\n      /* \\u7E26\\u4E2D\\u6A2A */\\n      .tcy {\\n      -webkit-text-combine: horizontal;\\n      text-combine: horizontal;\\n      -ms-text-combine-horizontal: all;\\n      text-combine-horizontal: digit 2;\\n      text-combine-upright: digit 2;\\n      }\\n  \\n      /* \\u570F\\u70B9\\uFF08<span class=\\\"smaller\\\">\\u30B4\\u30DE</span>\\uFF09 */\\n      em.sesame_dot {\\n      font-style: normal;\\n      -webkit-text-emphasis-style: sesame;\\n      text-emphasis-style: sesame;\\n      }\\n  \\n      /*\\u8457\\u4F5C\\u8005*/\\n      .author {\\n      position: absolute;\\n      bottom: 0;\\n      font-size: 8.5pt;\\n      margin-top: 50pt;\\n      letter-spacing: normal;\\n      }\\n  \\n      /*\\u753B\\u50CF\\uFF0B\\u30AD\\u30E3\\u30D7\\u30B7\\u30E7\\u30F3*/\\n      figure {\\n      display: block;\\n      width: 236pt;\\n      -ms-writing-mode: lr-tb;\\n      -webkit-writing-mode: horizontal-tb;\\n      writing-mode: horizontal-tb;\\n      }\\n  \\n      figure img {\\n      width: 100%;\\n      height: auto;\\n      vertical-align: bottom;\\n      }\\n  \\n      figcaption {\\n      text-align: left;\\n      font-size: 7pt;\\n      }\\n  \\n      /*\\u5965\\u4ED8*/\\n      .colophon {\\n      font-size: 7pt;\\n      margin-right: 48pt;\\n      }\\n      /* \\u7D1A\\u3055\\u3052 */\\n      span.smaller{\\n          font-size:6.5pt\\n      }\\n  \\n    div.comment {\\n        display:none;\\n    }\\n\\n    p.blank {\\n        color:transparent;\\n    }\\n\\n  @media screen{\\n      body {\\n            writing-mode: vertical-rl;\\n            font-family: \" + fontfamily + \";\\n            height: \" + pageheight + \";\\n            overflow-y:hidden;\\n            padding:0;\\n        }\\n        \\n        #cursor {\\n            background-color: rgb(125,125,125,);\\n            animation-duration: 0.5s;\\n            animation-name: cursorAnimation;\\n            animation-iteration-count: infinite;\\n        }\\n  \\n        p {\\n            height: \" + pageheight + \";\\n            font-family: \" + fontfamily + \";\\n            font-size: \" + fontsize + \";\\n            margin:0 0 0 0;\\n            vertical-align: middle;\\n        }\\n          \\n        em.side-dot {\\n            font-style: normal;\\n            text-emphasis: filled sesame rgb(128,128,128);\\n            -webkit-text-emphasis: filled sesame rgb(128,128,128);\\n        }\\n        \\n        span.tcy {\\n            text-combine: horizontal;\\n            -webkit-text-combine:horizontal;\\n        }\\n\\n        @keyframes cursorAnimation {\\n                from {\\n                    background-color: rgba(66,66,66,0);\\n                }\\n            \\n                to {\\n                    background-color: rgba(125,125,125,0.7);\\n                }\\n            }\\n  \\n          body{\\n              background-image:   linear-gradient(to right, rgba(50, 50, 50, 0.5) 0.5pt, rgba(0, 0, 50, 0.05) 10em);\\n              background-size:    \" + pagewidth + \" \" + pageheight + \";\\n              background-repeat:  repeat-x;\\n              background-position: right 0px;\\n          }\\n          p{\\n              background-image:   linear-gradient( rgba(50, 50, 50, 1) 0.5pt, transparent 1pt),\\n                                  linear-gradient(to right, rgba(50, 50, 50, 1) 0.5pt, rgba(0, 0, 50, 0.05) 1pt);\\n              background-size:    \" + lineheight + \" \" + fontsize + \",\\n                                  \" + lineheight + \" \" + fontsize + \";\\n              background-repeat:  repeat,\\n                                  repeat;\\n              background-position: right 0px,\\n                                  right 0px;\\n          }\\n\\n          div.indent-1 p{\\n            height: calc( \" + pageheight + \" - (\" + fontsize + \"));\\n            padding-top: \" + fontsize + \";\\n            }\\n        \\n            div.indent-2 p{\\n            height: calc( \" + pageheight + \" - (\" + fontsize + \" * 2));\\n            padding-top: calc(\" + fontsize + \" * 2);\\n            }\\n        \\n            div.indent-3 p{\\n            height: calc( \" + pageheight + \" - (\" + fontsize + \" * 3));\\n            padding-top: calc(\" + fontsize + \" * 3);\\n            }\\n\\n        \\n          span.comment{\\n            display:block;\\n            border-radius:1em;\\n            border:1.5pt solid rgba(70,70,00,0.9);\\n            padding:0.25em 0.25em;\\n            position:absolute;\\n            margin-right: -3em;\\n            margin-top: 0.5em;\\n            top: \" + pageheight + \";\\n            background-color:rgba(50,50,00,0.5);\\n            max-width: 20em;\\n          }\\n\\n          span.comment::before{\\n            content: '';\\n            position: absolute;\\n            right: 1em;\\n            top: -15px;\\n            display: block;\\n            width: 0;\\n            height: 0;\\n            border-right: 15px solid transparent;\\n            border-bottom: 15px solid rgba(70,70,00,0.9);\\n            border-left: 15px solid transparent;\\n          }\\n\\n          span.commentbody{\\n              margin:0.5em 1em;\\n              writing-mode:lr-tb;\\n              font-family:sans-serif;\\n              font-size:0.8em;\\n              line-height:1;\\n          }\\n  \\n      }\\n        </style>\\n      <link rel=\\\"stylesheet\\\" href=\\\"\\\">\\n  </head>\\n  <body>\\n  \" + mytext + \"\\n  \\n  <script>\\n  \\n  setTimeout( (function(){\\n      var width = document.body.clientWidth;\\n      var cursor = document.getElementById('cursor');\\n      var panelWidth = window.innerWidth;\\n      var scrollEnd = cursor.offsetLeft - width + (panelWidth / 2);\\n      window.scrollTo( scrollEnd , scrollEnd);\\n      console.log(width, cursor, panelWidth, scrollEnd);\\n  }), 1);\\n\\n</script>\\n  </body>\\n  </html>\";\n}\n","'use strict';\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if ((buf[i] & 0x80) === 0x00) {  // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {  // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0  // overlong\n      ) {\n        return false;\n      }\n\n      i += 2;\n    } else if ((buf[i] & 0xf0) === 0xe0) {  // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80 ||  // overlong\n        buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0  // surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      }\n\n      i += 3;\n    } else if ((buf[i] & 0xf8) === 0xf0) {  // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80 ||  // overlong\n        buf[i] === 0xf4 && buf[i + 1] > 0x8f || buf[i] > 0xf4  // > U+10FFFF\n      ) {\n        return false;\n      }\n\n      i += 4;\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nmodule.exports = isValidUTF8;\n","'use strict';\n\ntry {\n  module.exports = require('node-gyp-build')(__dirname);\n} catch (e) {\n  module.exports = require('./fallback');\n}\n","'use strict';\n\nconst WebSocket = require('./lib/websocket');\n\nWebSocket.createWebSocketStream = require('./lib/stream');\nWebSocket.Server = require('./lib/websocket-server');\nWebSocket.Receiver = require('./lib/receiver');\nWebSocket.Sender = require('./lib/sender');\n\nmodule.exports = WebSocket;\n","'use strict';\n\nconst { EMPTY_BUFFER } = require('./constants');\n\n/**\n * Merges an array of buffers into a new buffer.\n *\n * @param {Buffer[]} list The array of buffers to concat\n * @param {Number} totalLength The total length of buffers in the list\n * @return {Buffer} The resulting buffer\n * @public\n */\nfunction concat(list, totalLength) {\n  if (list.length === 0) return EMPTY_BUFFER;\n  if (list.length === 1) return list[0];\n\n  const target = Buffer.allocUnsafe(totalLength);\n  let offset = 0;\n\n  for (let i = 0; i < list.length; i++) {\n    const buf = list[i];\n    target.set(buf, offset);\n    offset += buf.length;\n  }\n\n  if (offset < totalLength) return target.slice(0, offset);\n\n  return target;\n}\n\n/**\n * Masks a buffer using the given mask.\n *\n * @param {Buffer} source The buffer to mask\n * @param {Buffer} mask The mask to use\n * @param {Buffer} output The buffer where to store the result\n * @param {Number} offset The offset at which to start writing\n * @param {Number} length The number of bytes to mask.\n * @public\n */\nfunction _mask(source, mask, output, offset, length) {\n  for (let i = 0; i < length; i++) {\n    output[offset + i] = source[i] ^ mask[i & 3];\n  }\n}\n\n/**\n * Unmasks a buffer using the given mask.\n *\n * @param {Buffer} buffer The buffer to unmask\n * @param {Buffer} mask The mask to use\n * @public\n */\nfunction _unmask(buffer, mask) {\n  // Required until https://github.com/nodejs/node/issues/9006 is resolved.\n  const length = buffer.length;\n  for (let i = 0; i < length; i++) {\n    buffer[i] ^= mask[i & 3];\n  }\n}\n\n/**\n * Converts a buffer to an `ArrayBuffer`.\n *\n * @param {Buffer} buf The buffer to convert\n * @return {ArrayBuffer} Converted buffer\n * @public\n */\nfunction toArrayBuffer(buf) {\n  if (buf.byteLength === buf.buffer.byteLength) {\n    return buf.buffer;\n  }\n\n  return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\n}\n\n/**\n * Converts `data` to a `Buffer`.\n *\n * @param {*} data The data to convert\n * @return {Buffer} The buffer\n * @throws {TypeError}\n * @public\n */\nfunction toBuffer(data) {\n  toBuffer.readOnly = true;\n\n  if (Buffer.isBuffer(data)) return data;\n\n  let buf;\n\n  if (data instanceof ArrayBuffer) {\n    buf = Buffer.from(data);\n  } else if (ArrayBuffer.isView(data)) {\n    buf = Buffer.from(data.buffer, data.byteOffset, data.byteLength);\n  } else {\n    buf = Buffer.from(data);\n    toBuffer.readOnly = false;\n  }\n\n  return buf;\n}\n\ntry {\n  const bufferUtil = require('bufferutil');\n  const bu = bufferUtil.BufferUtil || bufferUtil;\n\n  module.exports = {\n    concat,\n    mask(source, mask, output, offset, length) {\n      if (length < 48) _mask(source, mask, output, offset, length);\n      else bu.mask(source, mask, output, offset, length);\n    },\n    toArrayBuffer,\n    toBuffer,\n    unmask(buffer, mask) {\n      if (buffer.length < 32) _unmask(buffer, mask);\n      else bu.unmask(buffer, mask);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    concat,\n    mask: _mask,\n    toArrayBuffer,\n    toBuffer,\n    unmask: _unmask\n  };\n}\n","'use strict';\n\nmodule.exports = {\n  BINARY_TYPES: ['nodebuffer', 'arraybuffer', 'fragments'],\n  GUID: '258EAFA5-E914-47DA-95CA-C5AB0DC85B11',\n  kStatusCode: Symbol('status-code'),\n  kWebSocket: Symbol('websocket'),\n  EMPTY_BUFFER: Buffer.alloc(0),\n  NOOP: () => {}\n};\n","'use strict';\n\n/**\n * Class representing an event.\n *\n * @private\n */\nclass Event {\n  /**\n   * Create a new `Event`.\n   *\n   * @param {String} type The name of the event\n   * @param {Object} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(type, target) {\n    this.target = target;\n    this.type = type;\n  }\n}\n\n/**\n * Class representing a message event.\n *\n * @extends Event\n * @private\n */\nclass MessageEvent extends Event {\n  /**\n   * Create a new `MessageEvent`.\n   *\n   * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The received data\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(data, target) {\n    super('message', target);\n\n    this.data = data;\n  }\n}\n\n/**\n * Class representing a close event.\n *\n * @extends Event\n * @private\n */\nclass CloseEvent extends Event {\n  /**\n   * Create a new `CloseEvent`.\n   *\n   * @param {Number} code The status code explaining why the connection is being\n   *     closed\n   * @param {String} reason A human-readable string explaining why the\n   *     connection is closing\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(code, reason, target) {\n    super('close', target);\n\n    this.wasClean = target._closeFrameReceived && target._closeFrameSent;\n    this.reason = reason;\n    this.code = code;\n  }\n}\n\n/**\n * Class representing an open event.\n *\n * @extends Event\n * @private\n */\nclass OpenEvent extends Event {\n  /**\n   * Create a new `OpenEvent`.\n   *\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(target) {\n    super('open', target);\n  }\n}\n\n/**\n * Class representing an error event.\n *\n * @extends Event\n * @private\n */\nclass ErrorEvent extends Event {\n  /**\n   * Create a new `ErrorEvent`.\n   *\n   * @param {Object} error The error that generated this event\n   * @param {WebSocket} target A reference to the target to which the event was\n   *     dispatched\n   */\n  constructor(error, target) {\n    super('error', target);\n\n    this.message = error.message;\n    this.error = error;\n  }\n}\n\n/**\n * This provides methods for emulating the `EventTarget` interface. It's not\n * meant to be used directly.\n *\n * @mixin\n */\nconst EventTarget = {\n  /**\n   * Register an event listener.\n   *\n   * @param {String} type A string representing the event type to listen for\n   * @param {Function} listener The listener to add\n   * @param {Object} [options] An options object specifies characteristics about\n   *     the event listener\n   * @param {Boolean} [options.once=false] A `Boolean`` indicating that the\n   *     listener should be invoked at most once after being added. If `true`,\n   *     the listener would be automatically removed when invoked.\n   * @public\n   */\n  addEventListener(type, listener, options) {\n    if (typeof listener !== 'function') return;\n\n    function onMessage(data) {\n      listener.call(this, new MessageEvent(data, this));\n    }\n\n    function onClose(code, message) {\n      listener.call(this, new CloseEvent(code, message, this));\n    }\n\n    function onError(error) {\n      listener.call(this, new ErrorEvent(error, this));\n    }\n\n    function onOpen() {\n      listener.call(this, new OpenEvent(this));\n    }\n\n    const method = options && options.once ? 'once' : 'on';\n\n    if (type === 'message') {\n      onMessage._listener = listener;\n      this[method](type, onMessage);\n    } else if (type === 'close') {\n      onClose._listener = listener;\n      this[method](type, onClose);\n    } else if (type === 'error') {\n      onError._listener = listener;\n      this[method](type, onError);\n    } else if (type === 'open') {\n      onOpen._listener = listener;\n      this[method](type, onOpen);\n    } else {\n      this[method](type, listener);\n    }\n  },\n\n  /**\n   * Remove an event listener.\n   *\n   * @param {String} type A string representing the event type to remove\n   * @param {Function} listener The listener to remove\n   * @public\n   */\n  removeEventListener(type, listener) {\n    const listeners = this.listeners(type);\n\n    for (let i = 0; i < listeners.length; i++) {\n      if (listeners[i] === listener || listeners[i]._listener === listener) {\n        this.removeListener(type, listeners[i]);\n      }\n    }\n  }\n};\n\nmodule.exports = EventTarget;\n","'use strict';\n\n//\n// Allowed token characters:\n//\n// '!', '#', '$', '%', '&', ''', '*', '+', '-',\n// '.', 0-9, A-Z, '^', '_', '`', a-z, '|', '~'\n//\n// tokenChars[32] === 0 // ' '\n// tokenChars[33] === 1 // '!'\n// tokenChars[34] === 0 // '\"'\n// ...\n//\n// prettier-ignore\nconst tokenChars = [\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 0 - 15\n  0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 16 - 31\n  0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 0, // 32 - 47\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, // 48 - 63\n  0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 64 - 79\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 1, // 80 - 95\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 96 - 111\n  1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0 // 112 - 127\n];\n\n/**\n * Adds an offer to the map of extension offers or a parameter to the map of\n * parameters.\n *\n * @param {Object} dest The map of extension offers or parameters\n * @param {String} name The extension or parameter name\n * @param {(Object|Boolean|String)} elem The extension parameters or the\n *     parameter value\n * @private\n */\nfunction push(dest, name, elem) {\n  if (dest[name] === undefined) dest[name] = [elem];\n  else dest[name].push(elem);\n}\n\n/**\n * Parses the `Sec-WebSocket-Extensions` header into an object.\n *\n * @param {String} header The field value of the header\n * @return {Object} The parsed object\n * @public\n */\nfunction parse(header) {\n  const offers = Object.create(null);\n\n  if (header === undefined || header === '') return offers;\n\n  let params = Object.create(null);\n  let mustUnescape = false;\n  let isEscaping = false;\n  let inQuotes = false;\n  let extensionName;\n  let paramName;\n  let start = -1;\n  let end = -1;\n  let i = 0;\n\n  for (; i < header.length; i++) {\n    const code = header.charCodeAt(i);\n\n    if (extensionName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 /* ' ' */ || code === 0x09 /* '\\t' */) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b /* ';' */ || code === 0x2c /* ',' */) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        const name = header.slice(start, end);\n        if (code === 0x2c) {\n          push(offers, name, params);\n          params = Object.create(null);\n        } else {\n          extensionName = name;\n        }\n\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else if (paramName === undefined) {\n      if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (code === 0x20 || code === 0x09) {\n        if (end === -1 && start !== -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        push(params, header.slice(start, end), true);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        start = end = -1;\n      } else if (code === 0x3d /* '=' */ && start !== -1 && end === -1) {\n        paramName = header.slice(start, i);\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    } else {\n      //\n      // The value of a quoted-string after unescaping must conform to the\n      // token ABNF, so only token characters are valid.\n      // Ref: https://tools.ietf.org/html/rfc6455#section-9.1\n      //\n      if (isEscaping) {\n        if (tokenChars[code] !== 1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n        if (start === -1) start = i;\n        else if (!mustUnescape) mustUnescape = true;\n        isEscaping = false;\n      } else if (inQuotes) {\n        if (tokenChars[code] === 1) {\n          if (start === -1) start = i;\n        } else if (code === 0x22 /* '\"' */ && start !== -1) {\n          inQuotes = false;\n          end = i;\n        } else if (code === 0x5c /* '\\' */) {\n          isEscaping = true;\n        } else {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n      } else if (code === 0x22 && header.charCodeAt(i - 1) === 0x3d) {\n        inQuotes = true;\n      } else if (end === -1 && tokenChars[code] === 1) {\n        if (start === -1) start = i;\n      } else if (start !== -1 && (code === 0x20 || code === 0x09)) {\n        if (end === -1) end = i;\n      } else if (code === 0x3b || code === 0x2c) {\n        if (start === -1) {\n          throw new SyntaxError(`Unexpected character at index ${i}`);\n        }\n\n        if (end === -1) end = i;\n        let value = header.slice(start, end);\n        if (mustUnescape) {\n          value = value.replace(/\\\\/g, '');\n          mustUnescape = false;\n        }\n        push(params, paramName, value);\n        if (code === 0x2c) {\n          push(offers, extensionName, params);\n          params = Object.create(null);\n          extensionName = undefined;\n        }\n\n        paramName = undefined;\n        start = end = -1;\n      } else {\n        throw new SyntaxError(`Unexpected character at index ${i}`);\n      }\n    }\n  }\n\n  if (start === -1 || inQuotes) {\n    throw new SyntaxError('Unexpected end of input');\n  }\n\n  if (end === -1) end = i;\n  const token = header.slice(start, end);\n  if (extensionName === undefined) {\n    push(offers, token, params);\n  } else {\n    if (paramName === undefined) {\n      push(params, token, true);\n    } else if (mustUnescape) {\n      push(params, paramName, token.replace(/\\\\/g, ''));\n    } else {\n      push(params, paramName, token);\n    }\n    push(offers, extensionName, params);\n  }\n\n  return offers;\n}\n\n/**\n * Builds the `Sec-WebSocket-Extensions` header field value.\n *\n * @param {Object} extensions The map of extensions and parameters to format\n * @return {String} A string representing the given object\n * @public\n */\nfunction format(extensions) {\n  return Object.keys(extensions)\n    .map((extension) => {\n      let configurations = extensions[extension];\n      if (!Array.isArray(configurations)) configurations = [configurations];\n      return configurations\n        .map((params) => {\n          return [extension]\n            .concat(\n              Object.keys(params).map((k) => {\n                let values = params[k];\n                if (!Array.isArray(values)) values = [values];\n                return values\n                  .map((v) => (v === true ? k : `${k}=${v}`))\n                  .join('; ');\n              })\n            )\n            .join('; ');\n        })\n        .join(', ');\n    })\n    .join(', ');\n}\n\nmodule.exports = { format, parse };\n","'use strict';\n\nconst kDone = Symbol('kDone');\nconst kRun = Symbol('kRun');\n\n/**\n * A very simple job queue with adjustable concurrency. Adapted from\n * https://github.com/STRML/async-limiter\n */\nclass Limiter {\n  /**\n   * Creates a new `Limiter`.\n   *\n   * @param {Number} [concurrency=Infinity] The maximum number of jobs allowed\n   *     to run concurrently\n   */\n  constructor(concurrency) {\n    this[kDone] = () => {\n      this.pending--;\n      this[kRun]();\n    };\n    this.concurrency = concurrency || Infinity;\n    this.jobs = [];\n    this.pending = 0;\n  }\n\n  /**\n   * Adds a job to the queue.\n   *\n   * @param {Function} job The job to run\n   * @public\n   */\n  add(job) {\n    this.jobs.push(job);\n    this[kRun]();\n  }\n\n  /**\n   * Removes a job from the queue and runs it if possible.\n   *\n   * @private\n   */\n  [kRun]() {\n    if (this.pending === this.concurrency) return;\n\n    if (this.jobs.length) {\n      const job = this.jobs.shift();\n\n      this.pending++;\n      job(this[kDone]);\n    }\n  }\n}\n\nmodule.exports = Limiter;\n","'use strict';\n\nconst zlib = require('zlib');\n\nconst bufferUtil = require('./buffer-util');\nconst Limiter = require('./limiter');\nconst { kStatusCode, NOOP } = require('./constants');\n\nconst TRAILER = Buffer.from([0x00, 0x00, 0xff, 0xff]);\nconst kPerMessageDeflate = Symbol('permessage-deflate');\nconst kTotalLength = Symbol('total-length');\nconst kCallback = Symbol('callback');\nconst kBuffers = Symbol('buffers');\nconst kError = Symbol('error');\n\n//\n// We limit zlib concurrency, which prevents severe memory fragmentation\n// as documented in https://github.com/nodejs/node/issues/8871#issuecomment-250915913\n// and https://github.com/websockets/ws/issues/1202\n//\n// Intentionally global; it's the global thread pool that's an issue.\n//\nlet zlibLimiter;\n\n/**\n * permessage-deflate implementation.\n */\nclass PerMessageDeflate {\n  /**\n   * Creates a PerMessageDeflate instance.\n   *\n   * @param {Object} [options] Configuration options\n   * @param {Boolean} [options.serverNoContextTakeover=false] Request/accept\n   *     disabling of server context takeover\n   * @param {Boolean} [options.clientNoContextTakeover=false] Advertise/\n   *     acknowledge disabling of client context takeover\n   * @param {(Boolean|Number)} [options.serverMaxWindowBits] Request/confirm the\n   *     use of a custom server window size\n   * @param {(Boolean|Number)} [options.clientMaxWindowBits] Advertise support\n   *     for, or request, a custom client window size\n   * @param {Object} [options.zlibDeflateOptions] Options to pass to zlib on\n   *     deflate\n   * @param {Object} [options.zlibInflateOptions] Options to pass to zlib on\n   *     inflate\n   * @param {Number} [options.threshold=1024] Size (in bytes) below which\n   *     messages should not be compressed\n   * @param {Number} [options.concurrencyLimit=10] The number of concurrent\n   *     calls to zlib\n   * @param {Boolean} [isServer=false] Create the instance in either server or\n   *     client mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(options, isServer, maxPayload) {\n    this._maxPayload = maxPayload | 0;\n    this._options = options || {};\n    this._threshold =\n      this._options.threshold !== undefined ? this._options.threshold : 1024;\n    this._isServer = !!isServer;\n    this._deflate = null;\n    this._inflate = null;\n\n    this.params = null;\n\n    if (!zlibLimiter) {\n      const concurrency =\n        this._options.concurrencyLimit !== undefined\n          ? this._options.concurrencyLimit\n          : 10;\n      zlibLimiter = new Limiter(concurrency);\n    }\n  }\n\n  /**\n   * @type {String}\n   */\n  static get extensionName() {\n    return 'permessage-deflate';\n  }\n\n  /**\n   * Create an extension negotiation offer.\n   *\n   * @return {Object} Extension parameters\n   * @public\n   */\n  offer() {\n    const params = {};\n\n    if (this._options.serverNoContextTakeover) {\n      params.server_no_context_takeover = true;\n    }\n    if (this._options.clientNoContextTakeover) {\n      params.client_no_context_takeover = true;\n    }\n    if (this._options.serverMaxWindowBits) {\n      params.server_max_window_bits = this._options.serverMaxWindowBits;\n    }\n    if (this._options.clientMaxWindowBits) {\n      params.client_max_window_bits = this._options.clientMaxWindowBits;\n    } else if (this._options.clientMaxWindowBits == null) {\n      params.client_max_window_bits = true;\n    }\n\n    return params;\n  }\n\n  /**\n   * Accept an extension negotiation offer/response.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Object} Accepted configuration\n   * @public\n   */\n  accept(configurations) {\n    configurations = this.normalizeParams(configurations);\n\n    this.params = this._isServer\n      ? this.acceptAsServer(configurations)\n      : this.acceptAsClient(configurations);\n\n    return this.params;\n  }\n\n  /**\n   * Releases all resources used by the extension.\n   *\n   * @public\n   */\n  cleanup() {\n    if (this._inflate) {\n      this._inflate.close();\n      this._inflate = null;\n    }\n\n    if (this._deflate) {\n      const callback = this._deflate[kCallback];\n\n      this._deflate.close();\n      this._deflate = null;\n\n      if (callback) {\n        callback(\n          new Error(\n            'The deflate stream was closed while data was being processed'\n          )\n        );\n      }\n    }\n  }\n\n  /**\n   *  Accept an extension negotiation offer.\n   *\n   * @param {Array} offers The extension negotiation offers\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsServer(offers) {\n    const opts = this._options;\n    const accepted = offers.find((params) => {\n      if (\n        (opts.serverNoContextTakeover === false &&\n          params.server_no_context_takeover) ||\n        (params.server_max_window_bits &&\n          (opts.serverMaxWindowBits === false ||\n            (typeof opts.serverMaxWindowBits === 'number' &&\n              opts.serverMaxWindowBits > params.server_max_window_bits))) ||\n        (typeof opts.clientMaxWindowBits === 'number' &&\n          !params.client_max_window_bits)\n      ) {\n        return false;\n      }\n\n      return true;\n    });\n\n    if (!accepted) {\n      throw new Error('None of the extension offers can be accepted');\n    }\n\n    if (opts.serverNoContextTakeover) {\n      accepted.server_no_context_takeover = true;\n    }\n    if (opts.clientNoContextTakeover) {\n      accepted.client_no_context_takeover = true;\n    }\n    if (typeof opts.serverMaxWindowBits === 'number') {\n      accepted.server_max_window_bits = opts.serverMaxWindowBits;\n    }\n    if (typeof opts.clientMaxWindowBits === 'number') {\n      accepted.client_max_window_bits = opts.clientMaxWindowBits;\n    } else if (\n      accepted.client_max_window_bits === true ||\n      opts.clientMaxWindowBits === false\n    ) {\n      delete accepted.client_max_window_bits;\n    }\n\n    return accepted;\n  }\n\n  /**\n   * Accept the extension negotiation response.\n   *\n   * @param {Array} response The extension negotiation response\n   * @return {Object} Accepted configuration\n   * @private\n   */\n  acceptAsClient(response) {\n    const params = response[0];\n\n    if (\n      this._options.clientNoContextTakeover === false &&\n      params.client_no_context_takeover\n    ) {\n      throw new Error('Unexpected parameter \"client_no_context_takeover\"');\n    }\n\n    if (!params.client_max_window_bits) {\n      if (typeof this._options.clientMaxWindowBits === 'number') {\n        params.client_max_window_bits = this._options.clientMaxWindowBits;\n      }\n    } else if (\n      this._options.clientMaxWindowBits === false ||\n      (typeof this._options.clientMaxWindowBits === 'number' &&\n        params.client_max_window_bits > this._options.clientMaxWindowBits)\n    ) {\n      throw new Error(\n        'Unexpected or invalid parameter \"client_max_window_bits\"'\n      );\n    }\n\n    return params;\n  }\n\n  /**\n   * Normalize parameters.\n   *\n   * @param {Array} configurations The extension negotiation offers/reponse\n   * @return {Array} The offers/response with normalized parameters\n   * @private\n   */\n  normalizeParams(configurations) {\n    configurations.forEach((params) => {\n      Object.keys(params).forEach((key) => {\n        let value = params[key];\n\n        if (value.length > 1) {\n          throw new Error(`Parameter \"${key}\" must have only a single value`);\n        }\n\n        value = value[0];\n\n        if (key === 'client_max_window_bits') {\n          if (value !== true) {\n            const num = +value;\n            if (!Number.isInteger(num) || num < 8 || num > 15) {\n              throw new TypeError(\n                `Invalid value for parameter \"${key}\": ${value}`\n              );\n            }\n            value = num;\n          } else if (!this._isServer) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else if (key === 'server_max_window_bits') {\n          const num = +value;\n          if (!Number.isInteger(num) || num < 8 || num > 15) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n          value = num;\n        } else if (\n          key === 'client_no_context_takeover' ||\n          key === 'server_no_context_takeover'\n        ) {\n          if (value !== true) {\n            throw new TypeError(\n              `Invalid value for parameter \"${key}\": ${value}`\n            );\n          }\n        } else {\n          throw new Error(`Unknown parameter \"${key}\"`);\n        }\n\n        params[key] = value;\n      });\n    });\n\n    return configurations;\n  }\n\n  /**\n   * Decompress data. Concurrency limited.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  decompress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._decompress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Compress data. Concurrency limited.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @public\n   */\n  compress(data, fin, callback) {\n    zlibLimiter.add((done) => {\n      this._compress(data, fin, (err, result) => {\n        done();\n        callback(err, result);\n      });\n    });\n  }\n\n  /**\n   * Decompress data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _decompress(data, fin, callback) {\n    const endpoint = this._isServer ? 'client' : 'server';\n\n    if (!this._inflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._inflate = zlib.createInflateRaw({\n        ...this._options.zlibInflateOptions,\n        windowBits\n      });\n      this._inflate[kPerMessageDeflate] = this;\n      this._inflate[kTotalLength] = 0;\n      this._inflate[kBuffers] = [];\n      this._inflate.on('error', inflateOnError);\n      this._inflate.on('data', inflateOnData);\n    }\n\n    this._inflate[kCallback] = callback;\n\n    this._inflate.write(data);\n    if (fin) this._inflate.write(TRAILER);\n\n    this._inflate.flush(() => {\n      const err = this._inflate[kError];\n\n      if (err) {\n        this._inflate.close();\n        this._inflate = null;\n        callback(err);\n        return;\n      }\n\n      const data = bufferUtil.concat(\n        this._inflate[kBuffers],\n        this._inflate[kTotalLength]\n      );\n\n      if (this._inflate._readableState.endEmitted) {\n        this._inflate.close();\n        this._inflate = null;\n      } else {\n        this._inflate[kTotalLength] = 0;\n        this._inflate[kBuffers] = [];\n\n        if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n          this._inflate.reset();\n        }\n      }\n\n      callback(null, data);\n    });\n  }\n\n  /**\n   * Compress data.\n   *\n   * @param {Buffer} data Data to compress\n   * @param {Boolean} fin Specifies whether or not this is the last fragment\n   * @param {Function} callback Callback\n   * @private\n   */\n  _compress(data, fin, callback) {\n    const endpoint = this._isServer ? 'server' : 'client';\n\n    if (!this._deflate) {\n      const key = `${endpoint}_max_window_bits`;\n      const windowBits =\n        typeof this.params[key] !== 'number'\n          ? zlib.Z_DEFAULT_WINDOWBITS\n          : this.params[key];\n\n      this._deflate = zlib.createDeflateRaw({\n        ...this._options.zlibDeflateOptions,\n        windowBits\n      });\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      //\n      // An `'error'` event is emitted, only on Node.js < 10.0.0, if the\n      // `zlib.DeflateRaw` instance is closed while data is being processed.\n      // This can happen if `PerMessageDeflate#cleanup()` is called at the wrong\n      // time due to an abnormal WebSocket closure.\n      //\n      this._deflate.on('error', NOOP);\n      this._deflate.on('data', deflateOnData);\n    }\n\n    this._deflate[kCallback] = callback;\n\n    this._deflate.write(data);\n    this._deflate.flush(zlib.Z_SYNC_FLUSH, () => {\n      if (!this._deflate) {\n        //\n        // The deflate stream was closed while data was being processed.\n        //\n        return;\n      }\n\n      let data = bufferUtil.concat(\n        this._deflate[kBuffers],\n        this._deflate[kTotalLength]\n      );\n\n      if (fin) data = data.slice(0, data.length - 4);\n\n      //\n      // Ensure that the callback will not be called again in\n      // `PerMessageDeflate#cleanup()`.\n      //\n      this._deflate[kCallback] = null;\n\n      this._deflate[kTotalLength] = 0;\n      this._deflate[kBuffers] = [];\n\n      if (fin && this.params[`${endpoint}_no_context_takeover`]) {\n        this._deflate.reset();\n      }\n\n      callback(null, data);\n    });\n  }\n}\n\nmodule.exports = PerMessageDeflate;\n\n/**\n * The listener of the `zlib.DeflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction deflateOnData(chunk) {\n  this[kBuffers].push(chunk);\n  this[kTotalLength] += chunk.length;\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction inflateOnData(chunk) {\n  this[kTotalLength] += chunk.length;\n\n  if (\n    this[kPerMessageDeflate]._maxPayload < 1 ||\n    this[kTotalLength] <= this[kPerMessageDeflate]._maxPayload\n  ) {\n    this[kBuffers].push(chunk);\n    return;\n  }\n\n  this[kError] = new RangeError('Max payload size exceeded');\n  this[kError][kStatusCode] = 1009;\n  this.removeListener('data', inflateOnData);\n  this.reset();\n}\n\n/**\n * The listener of the `zlib.InflateRaw` stream `'error'` event.\n *\n * @param {Error} err The emitted error\n * @private\n */\nfunction inflateOnError(err) {\n  //\n  // There is no need to call `Zlib#close()` as the handle is automatically\n  // closed when an error is emitted.\n  //\n  this[kPerMessageDeflate]._inflate = null;\n  err[kStatusCode] = 1007;\n  this[kCallback](err);\n}\n","'use strict';\n\nconst { Writable } = require('stream');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  kStatusCode,\n  kWebSocket\n} = require('./constants');\nconst { concat, toArrayBuffer, unmask } = require('./buffer-util');\nconst { isValidStatusCode, isValidUTF8 } = require('./validation');\n\nconst GET_INFO = 0;\nconst GET_PAYLOAD_LENGTH_16 = 1;\nconst GET_PAYLOAD_LENGTH_64 = 2;\nconst GET_MASK = 3;\nconst GET_DATA = 4;\nconst INFLATING = 5;\n\n/**\n * HyBi Receiver implementation.\n *\n * @extends stream.Writable\n */\nclass Receiver extends Writable {\n  /**\n   * Creates a Receiver instance.\n   *\n   * @param {String} [binaryType=nodebuffer] The type for binary data\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   * @param {Boolean} [isServer=false] Specifies whether to operate in client or\n   *     server mode\n   * @param {Number} [maxPayload=0] The maximum allowed message length\n   */\n  constructor(binaryType, extensions, isServer, maxPayload) {\n    super();\n\n    this._binaryType = binaryType || BINARY_TYPES[0];\n    this[kWebSocket] = undefined;\n    this._extensions = extensions || {};\n    this._isServer = !!isServer;\n    this._maxPayload = maxPayload | 0;\n\n    this._bufferedBytes = 0;\n    this._buffers = [];\n\n    this._compressed = false;\n    this._payloadLength = 0;\n    this._mask = undefined;\n    this._fragmented = 0;\n    this._masked = false;\n    this._fin = false;\n    this._opcode = 0;\n\n    this._totalPayloadLength = 0;\n    this._messageLength = 0;\n    this._fragments = [];\n\n    this._state = GET_INFO;\n    this._loop = false;\n  }\n\n  /**\n   * Implements `Writable.prototype._write()`.\n   *\n   * @param {Buffer} chunk The chunk of data to write\n   * @param {String} encoding The character encoding of `chunk`\n   * @param {Function} cb Callback\n   * @private\n   */\n  _write(chunk, encoding, cb) {\n    if (this._opcode === 0x08 && this._state == GET_INFO) return cb();\n\n    this._bufferedBytes += chunk.length;\n    this._buffers.push(chunk);\n    this.startLoop(cb);\n  }\n\n  /**\n   * Consumes `n` bytes from the buffered data.\n   *\n   * @param {Number} n The number of bytes to consume\n   * @return {Buffer} The consumed bytes\n   * @private\n   */\n  consume(n) {\n    this._bufferedBytes -= n;\n\n    if (n === this._buffers[0].length) return this._buffers.shift();\n\n    if (n < this._buffers[0].length) {\n      const buf = this._buffers[0];\n      this._buffers[0] = buf.slice(n);\n      return buf.slice(0, n);\n    }\n\n    const dst = Buffer.allocUnsafe(n);\n\n    do {\n      const buf = this._buffers[0];\n      const offset = dst.length - n;\n\n      if (n >= buf.length) {\n        dst.set(this._buffers.shift(), offset);\n      } else {\n        dst.set(new Uint8Array(buf.buffer, buf.byteOffset, n), offset);\n        this._buffers[0] = buf.slice(n);\n      }\n\n      n -= buf.length;\n    } while (n > 0);\n\n    return dst;\n  }\n\n  /**\n   * Starts the parsing loop.\n   *\n   * @param {Function} cb Callback\n   * @private\n   */\n  startLoop(cb) {\n    let err;\n    this._loop = true;\n\n    do {\n      switch (this._state) {\n        case GET_INFO:\n          err = this.getInfo();\n          break;\n        case GET_PAYLOAD_LENGTH_16:\n          err = this.getPayloadLength16();\n          break;\n        case GET_PAYLOAD_LENGTH_64:\n          err = this.getPayloadLength64();\n          break;\n        case GET_MASK:\n          this.getMask();\n          break;\n        case GET_DATA:\n          err = this.getData(cb);\n          break;\n        default:\n          // `INFLATING`\n          this._loop = false;\n          return;\n      }\n    } while (this._loop);\n\n    cb(err);\n  }\n\n  /**\n   * Reads the first two bytes of a frame.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getInfo() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(2);\n\n    if ((buf[0] & 0x30) !== 0x00) {\n      this._loop = false;\n      return error(RangeError, 'RSV2 and RSV3 must be clear', true, 1002);\n    }\n\n    const compressed = (buf[0] & 0x40) === 0x40;\n\n    if (compressed && !this._extensions[PerMessageDeflate.extensionName]) {\n      this._loop = false;\n      return error(RangeError, 'RSV1 must be clear', true, 1002);\n    }\n\n    this._fin = (buf[0] & 0x80) === 0x80;\n    this._opcode = buf[0] & 0x0f;\n    this._payloadLength = buf[1] & 0x7f;\n\n    if (this._opcode === 0x00) {\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (!this._fragmented) {\n        this._loop = false;\n        return error(RangeError, 'invalid opcode 0', true, 1002);\n      }\n\n      this._opcode = this._fragmented;\n    } else if (this._opcode === 0x01 || this._opcode === 0x02) {\n      if (this._fragmented) {\n        this._loop = false;\n        return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n      }\n\n      this._compressed = compressed;\n    } else if (this._opcode > 0x07 && this._opcode < 0x0b) {\n      if (!this._fin) {\n        this._loop = false;\n        return error(RangeError, 'FIN must be set', true, 1002);\n      }\n\n      if (compressed) {\n        this._loop = false;\n        return error(RangeError, 'RSV1 must be clear', true, 1002);\n      }\n\n      if (this._payloadLength > 0x7d) {\n        this._loop = false;\n        return error(\n          RangeError,\n          `invalid payload length ${this._payloadLength}`,\n          true,\n          1002\n        );\n      }\n    } else {\n      this._loop = false;\n      return error(RangeError, `invalid opcode ${this._opcode}`, true, 1002);\n    }\n\n    if (!this._fin && !this._fragmented) this._fragmented = this._opcode;\n    this._masked = (buf[1] & 0x80) === 0x80;\n\n    if (this._isServer) {\n      if (!this._masked) {\n        this._loop = false;\n        return error(RangeError, 'MASK must be set', true, 1002);\n      }\n    } else if (this._masked) {\n      this._loop = false;\n      return error(RangeError, 'MASK must be clear', true, 1002);\n    }\n\n    if (this._payloadLength === 126) this._state = GET_PAYLOAD_LENGTH_16;\n    else if (this._payloadLength === 127) this._state = GET_PAYLOAD_LENGTH_64;\n    else return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+16).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength16() {\n    if (this._bufferedBytes < 2) {\n      this._loop = false;\n      return;\n    }\n\n    this._payloadLength = this.consume(2).readUInt16BE(0);\n    return this.haveLength();\n  }\n\n  /**\n   * Gets extended payload length (7+64).\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  getPayloadLength64() {\n    if (this._bufferedBytes < 8) {\n      this._loop = false;\n      return;\n    }\n\n    const buf = this.consume(8);\n    const num = buf.readUInt32BE(0);\n\n    //\n    // The maximum safe integer in JavaScript is 2^53 - 1. An error is returned\n    // if payload length is greater than this number.\n    //\n    if (num > Math.pow(2, 53 - 32) - 1) {\n      this._loop = false;\n      return error(\n        RangeError,\n        'Unsupported WebSocket frame: payload length > 2^53 - 1',\n        false,\n        1009\n      );\n    }\n\n    this._payloadLength = num * Math.pow(2, 32) + buf.readUInt32BE(4);\n    return this.haveLength();\n  }\n\n  /**\n   * Payload length has been read.\n   *\n   * @return {(RangeError|undefined)} A possible error\n   * @private\n   */\n  haveLength() {\n    if (this._payloadLength && this._opcode < 0x08) {\n      this._totalPayloadLength += this._payloadLength;\n      if (this._totalPayloadLength > this._maxPayload && this._maxPayload > 0) {\n        this._loop = false;\n        return error(RangeError, 'Max payload size exceeded', false, 1009);\n      }\n    }\n\n    if (this._masked) this._state = GET_MASK;\n    else this._state = GET_DATA;\n  }\n\n  /**\n   * Reads mask bytes.\n   *\n   * @private\n   */\n  getMask() {\n    if (this._bufferedBytes < 4) {\n      this._loop = false;\n      return;\n    }\n\n    this._mask = this.consume(4);\n    this._state = GET_DATA;\n  }\n\n  /**\n   * Reads data bytes.\n   *\n   * @param {Function} cb Callback\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  getData(cb) {\n    let data = EMPTY_BUFFER;\n\n    if (this._payloadLength) {\n      if (this._bufferedBytes < this._payloadLength) {\n        this._loop = false;\n        return;\n      }\n\n      data = this.consume(this._payloadLength);\n      if (this._masked) unmask(data, this._mask);\n    }\n\n    if (this._opcode > 0x07) return this.controlMessage(data);\n\n    if (this._compressed) {\n      this._state = INFLATING;\n      this.decompress(data, cb);\n      return;\n    }\n\n    if (data.length) {\n      //\n      // This message is not compressed so its lenght is the sum of the payload\n      // length of all fragments.\n      //\n      this._messageLength = this._totalPayloadLength;\n      this._fragments.push(data);\n    }\n\n    return this.dataMessage();\n  }\n\n  /**\n   * Decompresses data.\n   *\n   * @param {Buffer} data Compressed data\n   * @param {Function} cb Callback\n   * @private\n   */\n  decompress(data, cb) {\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    perMessageDeflate.decompress(data, this._fin, (err, buf) => {\n      if (err) return cb(err);\n\n      if (buf.length) {\n        this._messageLength += buf.length;\n        if (this._messageLength > this._maxPayload && this._maxPayload > 0) {\n          return cb(\n            error(RangeError, 'Max payload size exceeded', false, 1009)\n          );\n        }\n\n        this._fragments.push(buf);\n      }\n\n      const er = this.dataMessage();\n      if (er) return cb(er);\n\n      this.startLoop(cb);\n    });\n  }\n\n  /**\n   * Handles a data message.\n   *\n   * @return {(Error|undefined)} A possible error\n   * @private\n   */\n  dataMessage() {\n    if (this._fin) {\n      const messageLength = this._messageLength;\n      const fragments = this._fragments;\n\n      this._totalPayloadLength = 0;\n      this._messageLength = 0;\n      this._fragmented = 0;\n      this._fragments = [];\n\n      if (this._opcode === 2) {\n        let data;\n\n        if (this._binaryType === 'nodebuffer') {\n          data = concat(fragments, messageLength);\n        } else if (this._binaryType === 'arraybuffer') {\n          data = toArrayBuffer(concat(fragments, messageLength));\n        } else {\n          data = fragments;\n        }\n\n        this.emit('message', data);\n      } else {\n        const buf = concat(fragments, messageLength);\n\n        if (!isValidUTF8(buf)) {\n          this._loop = false;\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('message', buf.toString());\n      }\n    }\n\n    this._state = GET_INFO;\n  }\n\n  /**\n   * Handles a control message.\n   *\n   * @param {Buffer} data Data to handle\n   * @return {(Error|RangeError|undefined)} A possible error\n   * @private\n   */\n  controlMessage(data) {\n    if (this._opcode === 0x08) {\n      this._loop = false;\n\n      if (data.length === 0) {\n        this.emit('conclude', 1005, '');\n        this.end();\n      } else if (data.length === 1) {\n        return error(RangeError, 'invalid payload length 1', true, 1002);\n      } else {\n        const code = data.readUInt16BE(0);\n\n        if (!isValidStatusCode(code)) {\n          return error(RangeError, `invalid status code ${code}`, true, 1002);\n        }\n\n        const buf = data.slice(2);\n\n        if (!isValidUTF8(buf)) {\n          return error(Error, 'invalid UTF-8 sequence', true, 1007);\n        }\n\n        this.emit('conclude', code, buf.toString());\n        this.end();\n      }\n    } else if (this._opcode === 0x09) {\n      this.emit('ping', data);\n    } else {\n      this.emit('pong', data);\n    }\n\n    this._state = GET_INFO;\n  }\n}\n\nmodule.exports = Receiver;\n\n/**\n * Builds an error object.\n *\n * @param {(Error|RangeError)} ErrorCtor The error constructor\n * @param {String} message The error message\n * @param {Boolean} prefix Specifies whether or not to add a default prefix to\n *     `message`\n * @param {Number} statusCode The status code\n * @return {(Error|RangeError)} The error\n * @private\n */\nfunction error(ErrorCtor, message, prefix, statusCode) {\n  const err = new ErrorCtor(\n    prefix ? `Invalid WebSocket frame: ${message}` : message\n  );\n\n  Error.captureStackTrace(err, error);\n  err[kStatusCode] = statusCode;\n  return err;\n}\n","'use strict';\n\nconst { randomFillSync } = require('crypto');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst { EMPTY_BUFFER } = require('./constants');\nconst { isValidStatusCode } = require('./validation');\nconst { mask: applyMask, toBuffer } = require('./buffer-util');\n\nconst mask = Buffer.alloc(4);\n\n/**\n * HyBi Sender implementation.\n */\nclass Sender {\n  /**\n   * Creates a Sender instance.\n   *\n   * @param {net.Socket} socket The connection socket\n   * @param {Object} [extensions] An object containing the negotiated extensions\n   */\n  constructor(socket, extensions) {\n    this._extensions = extensions || {};\n    this._socket = socket;\n\n    this._firstFragment = true;\n    this._compress = false;\n\n    this._bufferedBytes = 0;\n    this._deflating = false;\n    this._queue = [];\n  }\n\n  /**\n   * Frames a piece of data according to the HyBi WebSocket protocol.\n   *\n   * @param {Buffer} data The data to frame\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @return {Buffer[]} The framed data as a list of `Buffer` instances\n   * @public\n   */\n  static frame(data, options) {\n    const merge = options.mask && options.readOnly;\n    let offset = options.mask ? 6 : 2;\n    let payloadLength = data.length;\n\n    if (data.length >= 65536) {\n      offset += 8;\n      payloadLength = 127;\n    } else if (data.length > 125) {\n      offset += 2;\n      payloadLength = 126;\n    }\n\n    const target = Buffer.allocUnsafe(merge ? data.length + offset : offset);\n\n    target[0] = options.fin ? options.opcode | 0x80 : options.opcode;\n    if (options.rsv1) target[0] |= 0x40;\n\n    target[1] = payloadLength;\n\n    if (payloadLength === 126) {\n      target.writeUInt16BE(data.length, 2);\n    } else if (payloadLength === 127) {\n      target.writeUInt32BE(0, 2);\n      target.writeUInt32BE(data.length, 6);\n    }\n\n    if (!options.mask) return [target, data];\n\n    randomFillSync(mask, 0, 4);\n\n    target[1] |= 0x80;\n    target[offset - 4] = mask[0];\n    target[offset - 3] = mask[1];\n    target[offset - 2] = mask[2];\n    target[offset - 1] = mask[3];\n\n    if (merge) {\n      applyMask(data, mask, target, offset, data.length);\n      return [target];\n    }\n\n    applyMask(data, mask, data, 0, data.length);\n    return [target, data];\n  }\n\n  /**\n   * Sends a close message to the other peer.\n   *\n   * @param {Number} [code] The status code component of the body\n   * @param {String} [data] The message component of the body\n   * @param {Boolean} [mask=false] Specifies whether or not to mask the message\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(code, data, mask, cb) {\n    let buf;\n\n    if (code === undefined) {\n      buf = EMPTY_BUFFER;\n    } else if (typeof code !== 'number' || !isValidStatusCode(code)) {\n      throw new TypeError('First argument must be a valid error code number');\n    } else if (data === undefined || data === '') {\n      buf = Buffer.allocUnsafe(2);\n      buf.writeUInt16BE(code, 0);\n    } else {\n      const length = Buffer.byteLength(data);\n\n      if (length > 123) {\n        throw new RangeError('The message must not be greater than 123 bytes');\n      }\n\n      buf = Buffer.allocUnsafe(2 + length);\n      buf.writeUInt16BE(code, 0);\n      buf.write(data, 2);\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doClose, buf, mask, cb]);\n    } else {\n      this.doClose(buf, mask, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a close message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doClose(data, mask, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x08,\n        mask,\n        readOnly: false\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a ping message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  ping(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPing, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPing(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a ping message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPing(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x09,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a pong message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  pong(data, mask, cb) {\n    const buf = toBuffer(data);\n\n    if (buf.length > 125) {\n      throw new RangeError('The data size must not be greater than 125 bytes');\n    }\n\n    if (this._deflating) {\n      this.enqueue([this.doPong, buf, mask, toBuffer.readOnly, cb]);\n    } else {\n      this.doPong(buf, mask, toBuffer.readOnly, cb);\n    }\n  }\n\n  /**\n   * Frames and sends a pong message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [mask=false] Specifies whether or not to mask `data`\n   * @param {Boolean} [readOnly=false] Specifies whether `data` can be modified\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  doPong(data, mask, readOnly, cb) {\n    this.sendFrame(\n      Sender.frame(data, {\n        fin: true,\n        rsv1: false,\n        opcode: 0x0a,\n        mask,\n        readOnly\n      }),\n      cb\n    );\n  }\n\n  /**\n   * Sends a data message to the other peer.\n   *\n   * @param {*} data The message to send\n   * @param {Object} options Options object\n   * @param {Boolean} [options.compress=false] Specifies whether or not to\n   *     compress `data`\n   * @param {Boolean} [options.binary=false] Specifies whether `data` is binary\n   *     or text\n   * @param {Boolean} [options.fin=false] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  send(data, options, cb) {\n    const buf = toBuffer(data);\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n    let opcode = options.binary ? 2 : 1;\n    let rsv1 = options.compress;\n\n    if (this._firstFragment) {\n      this._firstFragment = false;\n      if (rsv1 && perMessageDeflate) {\n        rsv1 = buf.length >= perMessageDeflate._threshold;\n      }\n      this._compress = rsv1;\n    } else {\n      rsv1 = false;\n      opcode = 0;\n    }\n\n    if (options.fin) this._firstFragment = true;\n\n    if (perMessageDeflate) {\n      const opts = {\n        fin: options.fin,\n        rsv1,\n        opcode,\n        mask: options.mask,\n        readOnly: toBuffer.readOnly\n      };\n\n      if (this._deflating) {\n        this.enqueue([this.dispatch, buf, this._compress, opts, cb]);\n      } else {\n        this.dispatch(buf, this._compress, opts, cb);\n      }\n    } else {\n      this.sendFrame(\n        Sender.frame(buf, {\n          fin: options.fin,\n          rsv1: false,\n          opcode,\n          mask: options.mask,\n          readOnly: toBuffer.readOnly\n        }),\n        cb\n      );\n    }\n  }\n\n  /**\n   * Dispatches a data message.\n   *\n   * @param {Buffer} data The message to send\n   * @param {Boolean} [compress=false] Specifies whether or not to compress\n   *     `data`\n   * @param {Object} options Options object\n   * @param {Number} options.opcode The opcode\n   * @param {Boolean} [options.readOnly=false] Specifies whether `data` can be\n   *     modified\n   * @param {Boolean} [options.fin=false] Specifies whether or not to set the\n   *     FIN bit\n   * @param {Boolean} [options.mask=false] Specifies whether or not to mask\n   *     `data`\n   * @param {Boolean} [options.rsv1=false] Specifies whether or not to set the\n   *     RSV1 bit\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  dispatch(data, compress, options, cb) {\n    if (!compress) {\n      this.sendFrame(Sender.frame(data, options), cb);\n      return;\n    }\n\n    const perMessageDeflate = this._extensions[PerMessageDeflate.extensionName];\n\n    this._bufferedBytes += data.length;\n    this._deflating = true;\n    perMessageDeflate.compress(data, options.fin, (_, buf) => {\n      if (this._socket.destroyed) {\n        const err = new Error(\n          'The socket was closed while data was being compressed'\n        );\n\n        if (typeof cb === 'function') cb(err);\n\n        for (let i = 0; i < this._queue.length; i++) {\n          const callback = this._queue[i][4];\n\n          if (typeof callback === 'function') callback(err);\n        }\n\n        return;\n      }\n\n      this._bufferedBytes -= data.length;\n      this._deflating = false;\n      options.readOnly = false;\n      this.sendFrame(Sender.frame(buf, options), cb);\n      this.dequeue();\n    });\n  }\n\n  /**\n   * Executes queued send operations.\n   *\n   * @private\n   */\n  dequeue() {\n    while (!this._deflating && this._queue.length) {\n      const params = this._queue.shift();\n\n      this._bufferedBytes -= params[1].length;\n      Reflect.apply(params[0], this, params.slice(1));\n    }\n  }\n\n  /**\n   * Enqueues a send operation.\n   *\n   * @param {Array} params Send operation parameters.\n   * @private\n   */\n  enqueue(params) {\n    this._bufferedBytes += params[1].length;\n    this._queue.push(params);\n  }\n\n  /**\n   * Sends a frame.\n   *\n   * @param {Buffer[]} list The frame to send\n   * @param {Function} [cb] Callback\n   * @private\n   */\n  sendFrame(list, cb) {\n    if (list.length === 2) {\n      this._socket.cork();\n      this._socket.write(list[0]);\n      this._socket.write(list[1], cb);\n      this._socket.uncork();\n    } else {\n      this._socket.write(list[0], cb);\n    }\n  }\n}\n\nmodule.exports = Sender;\n","'use strict';\n\nconst { Duplex } = require('stream');\n\n/**\n * Emits the `'close'` event on a stream.\n *\n * @param {stream.Duplex} The stream.\n * @private\n */\nfunction emitClose(stream) {\n  stream.emit('close');\n}\n\n/**\n * The listener of the `'end'` event.\n *\n * @private\n */\nfunction duplexOnEnd() {\n  if (!this.destroyed && this._writableState.finished) {\n    this.destroy();\n  }\n}\n\n/**\n * The listener of the `'error'` event.\n *\n * @param {Error} err The error\n * @private\n */\nfunction duplexOnError(err) {\n  this.removeListener('error', duplexOnError);\n  this.destroy();\n  if (this.listenerCount('error') === 0) {\n    // Do not suppress the throwing behavior.\n    this.emit('error', err);\n  }\n}\n\n/**\n * Wraps a `WebSocket` in a duplex stream.\n *\n * @param {WebSocket} ws The `WebSocket` to wrap\n * @param {Object} [options] The options for the `Duplex` constructor\n * @return {stream.Duplex} The duplex stream\n * @public\n */\nfunction createWebSocketStream(ws, options) {\n  let resumeOnReceiverDrain = true;\n\n  function receiverOnDrain() {\n    if (resumeOnReceiverDrain) ws._socket.resume();\n  }\n\n  if (ws.readyState === ws.CONNECTING) {\n    ws.once('open', function open() {\n      ws._receiver.removeAllListeners('drain');\n      ws._receiver.on('drain', receiverOnDrain);\n    });\n  } else {\n    ws._receiver.removeAllListeners('drain');\n    ws._receiver.on('drain', receiverOnDrain);\n  }\n\n  const duplex = new Duplex({\n    ...options,\n    autoDestroy: false,\n    emitClose: false,\n    objectMode: false,\n    writableObjectMode: false\n  });\n\n  ws.on('message', function message(msg) {\n    if (!duplex.push(msg)) {\n      resumeOnReceiverDrain = false;\n      ws._socket.pause();\n    }\n  });\n\n  ws.once('error', function error(err) {\n    if (duplex.destroyed) return;\n\n    duplex.destroy(err);\n  });\n\n  ws.once('close', function close() {\n    if (duplex.destroyed) return;\n\n    duplex.push(null);\n  });\n\n  duplex._destroy = function (err, callback) {\n    if (ws.readyState === ws.CLOSED) {\n      callback(err);\n      process.nextTick(emitClose, duplex);\n      return;\n    }\n\n    let called = false;\n\n    ws.once('error', function error(err) {\n      called = true;\n      callback(err);\n    });\n\n    ws.once('close', function close() {\n      if (!called) callback(err);\n      process.nextTick(emitClose, duplex);\n    });\n    ws.terminate();\n  };\n\n  duplex._final = function (callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._final(callback);\n      });\n      return;\n    }\n\n    // If the value of the `_socket` property is `null` it means that `ws` is a\n    // client websocket and the handshake failed. In fact, when this happens, a\n    // socket is never assigned to the websocket. Wait for the `'error'` event\n    // that will be emitted by the websocket.\n    if (ws._socket === null) return;\n\n    if (ws._socket._writableState.finished) {\n      callback();\n      if (duplex._readableState.endEmitted) duplex.destroy();\n    } else {\n      ws._socket.once('finish', function finish() {\n        // `duplex` is not destroyed here because the `'end'` event will be\n        // emitted on `duplex` after this `'finish'` event. The EOF signaling\n        // `null` chunk is, in fact, pushed when the websocket emits `'close'`.\n        callback();\n      });\n      ws.close();\n    }\n  };\n\n  duplex._read = function () {\n    if (ws.readyState === ws.OPEN && !resumeOnReceiverDrain) {\n      resumeOnReceiverDrain = true;\n      if (!ws._receiver._writableState.needDrain) ws._socket.resume();\n    }\n  };\n\n  duplex._write = function (chunk, encoding, callback) {\n    if (ws.readyState === ws.CONNECTING) {\n      ws.once('open', function open() {\n        duplex._write(chunk, encoding, callback);\n      });\n      return;\n    }\n\n    ws.send(chunk, callback);\n  };\n\n  duplex.on('end', duplexOnEnd);\n  duplex.on('error', duplexOnError);\n  return duplex;\n}\n\nmodule.exports = createWebSocketStream;\n","'use strict';\n\n/**\n * Checks if a status code is allowed in a close frame.\n *\n * @param {Number} code The status code\n * @return {Boolean} `true` if the status code is valid, else `false`\n * @public\n */\nfunction isValidStatusCode(code) {\n  return (\n    (code >= 1000 &&\n      code <= 1014 &&\n      code !== 1004 &&\n      code !== 1005 &&\n      code !== 1006) ||\n    (code >= 3000 && code <= 4999)\n  );\n}\n\n/**\n * Checks if a given buffer contains only correct UTF-8.\n * Ported from https://www.cl.cam.ac.uk/%7Emgk25/ucs/utf8_check.c by\n * Markus Kuhn.\n *\n * @param {Buffer} buf The buffer to check\n * @return {Boolean} `true` if `buf` contains only correct UTF-8, else `false`\n * @public\n */\nfunction _isValidUTF8(buf) {\n  const len = buf.length;\n  let i = 0;\n\n  while (i < len) {\n    if (buf[i] < 0x80) {\n      // 0xxxxxxx\n      i++;\n    } else if ((buf[i] & 0xe0) === 0xc0) {\n      // 110xxxxx 10xxxxxx\n      if (\n        i + 1 === len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i] & 0xfe) === 0xc0 // Overlong\n      ) {\n        return false;\n      } else {\n        i += 2;\n      }\n    } else if ((buf[i] & 0xf0) === 0xe0) {\n      // 1110xxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 2 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xe0 && (buf[i + 1] & 0xe0) === 0x80) || // Overlong\n        (buf[i] === 0xed && (buf[i + 1] & 0xe0) === 0xa0) // Surrogate (U+D800 - U+DFFF)\n      ) {\n        return false;\n      } else {\n        i += 3;\n      }\n    } else if ((buf[i] & 0xf8) === 0xf0) {\n      // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n      if (\n        i + 3 >= len ||\n        (buf[i + 1] & 0xc0) !== 0x80 ||\n        (buf[i + 2] & 0xc0) !== 0x80 ||\n        (buf[i + 3] & 0xc0) !== 0x80 ||\n        (buf[i] === 0xf0 && (buf[i + 1] & 0xf0) === 0x80) || // Overlong\n        (buf[i] === 0xf4 && buf[i + 1] > 0x8f) ||\n        buf[i] > 0xf4 // > U+10FFFF\n      ) {\n        return false;\n      } else {\n        i += 4;\n      }\n    } else {\n      return false;\n    }\n  }\n\n  return true;\n}\n\ntry {\n  let isValidUTF8 = require('utf-8-validate');\n\n  /* istanbul ignore if */\n  if (typeof isValidUTF8 === 'object') {\n    isValidUTF8 = isValidUTF8.Validation.isValidUTF8; // utf-8-validate@<3.0.0\n  }\n\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8(buf) {\n      return buf.length < 150 ? _isValidUTF8(buf) : isValidUTF8(buf);\n    }\n  };\n} catch (e) /* istanbul ignore next */ {\n  module.exports = {\n    isValidStatusCode,\n    isValidUTF8: _isValidUTF8\n  };\n}\n","'use strict';\n\nconst EventEmitter = require('events');\nconst { createHash } = require('crypto');\nconst { createServer, STATUS_CODES } = require('http');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst WebSocket = require('./websocket');\nconst { format, parse } = require('./extension');\nconst { GUID, kWebSocket } = require('./constants');\n\nconst keyRegex = /^[+/0-9A-Za-z]{22}==$/;\n\n/**\n * Class representing a WebSocket server.\n *\n * @extends EventEmitter\n */\nclass WebSocketServer extends EventEmitter {\n  /**\n   * Create a `WebSocketServer` instance.\n   *\n   * @param {Object} options Configuration options\n   * @param {Number} [options.backlog=511] The maximum length of the queue of\n   *     pending connections\n   * @param {Boolean} [options.clientTracking=true] Specifies whether or not to\n   *     track clients\n   * @param {Function} [options.handleProtocols] A hook to handle protocols\n   * @param {String} [options.host] The hostname where to bind the server\n   * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n   *     size\n   * @param {Boolean} [options.noServer=false] Enable no server mode\n   * @param {String} [options.path] Accept only connections matching this path\n   * @param {(Boolean|Object)} [options.perMessageDeflate=false] Enable/disable\n   *     permessage-deflate\n   * @param {Number} [options.port] The port where to bind the server\n   * @param {http.Server} [options.server] A pre-created HTTP/S server to use\n   * @param {Function} [options.verifyClient] A hook to reject connections\n   * @param {Function} [callback] A listener for the `listening` event\n   */\n  constructor(options, callback) {\n    super();\n\n    options = {\n      maxPayload: 100 * 1024 * 1024,\n      perMessageDeflate: false,\n      handleProtocols: null,\n      clientTracking: true,\n      verifyClient: null,\n      noServer: false,\n      backlog: null, // use default (511 as implemented in net.js)\n      server: null,\n      host: null,\n      path: null,\n      port: null,\n      ...options\n    };\n\n    if (options.port == null && !options.server && !options.noServer) {\n      throw new TypeError(\n        'One of the \"port\", \"server\", or \"noServer\" options must be specified'\n      );\n    }\n\n    if (options.port != null) {\n      this._server = createServer((req, res) => {\n        const body = STATUS_CODES[426];\n\n        res.writeHead(426, {\n          'Content-Length': body.length,\n          'Content-Type': 'text/plain'\n        });\n        res.end(body);\n      });\n      this._server.listen(\n        options.port,\n        options.host,\n        options.backlog,\n        callback\n      );\n    } else if (options.server) {\n      this._server = options.server;\n    }\n\n    if (this._server) {\n      const emitConnection = this.emit.bind(this, 'connection');\n\n      this._removeListeners = addListeners(this._server, {\n        listening: this.emit.bind(this, 'listening'),\n        error: this.emit.bind(this, 'error'),\n        upgrade: (req, socket, head) => {\n          this.handleUpgrade(req, socket, head, emitConnection);\n        }\n      });\n    }\n\n    if (options.perMessageDeflate === true) options.perMessageDeflate = {};\n    if (options.clientTracking) this.clients = new Set();\n    this.options = options;\n  }\n\n  /**\n   * Returns the bound address, the address family name, and port of the server\n   * as reported by the operating system if listening on an IP socket.\n   * If the server is listening on a pipe or UNIX domain socket, the name is\n   * returned as a string.\n   *\n   * @return {(Object|String|null)} The address of the server\n   * @public\n   */\n  address() {\n    if (this.options.noServer) {\n      throw new Error('The server is operating in \"noServer\" mode');\n    }\n\n    if (!this._server) return null;\n    return this._server.address();\n  }\n\n  /**\n   * Close the server.\n   *\n   * @param {Function} [cb] Callback\n   * @public\n   */\n  close(cb) {\n    if (cb) this.once('close', cb);\n\n    //\n    // Terminate all associated clients.\n    //\n    if (this.clients) {\n      for (const client of this.clients) client.terminate();\n    }\n\n    const server = this._server;\n\n    if (server) {\n      this._removeListeners();\n      this._removeListeners = this._server = null;\n\n      //\n      // Close the http server if it was internally created.\n      //\n      if (this.options.port != null) {\n        server.close(() => this.emit('close'));\n        return;\n      }\n    }\n\n    process.nextTick(emitClose, this);\n  }\n\n  /**\n   * See if a given request should be handled by this server instance.\n   *\n   * @param {http.IncomingMessage} req Request object to inspect\n   * @return {Boolean} `true` if the request is valid, else `false`\n   * @public\n   */\n  shouldHandle(req) {\n    if (this.options.path) {\n      const index = req.url.indexOf('?');\n      const pathname = index !== -1 ? req.url.slice(0, index) : req.url;\n\n      if (pathname !== this.options.path) return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Handle a HTTP Upgrade request.\n   *\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @public\n   */\n  handleUpgrade(req, socket, head, cb) {\n    socket.on('error', socketOnError);\n\n    const key =\n      req.headers['sec-websocket-key'] !== undefined\n        ? req.headers['sec-websocket-key'].trim()\n        : false;\n    const version = +req.headers['sec-websocket-version'];\n    const extensions = {};\n\n    if (\n      req.method !== 'GET' ||\n      req.headers.upgrade.toLowerCase() !== 'websocket' ||\n      !key ||\n      !keyRegex.test(key) ||\n      (version !== 8 && version !== 13) ||\n      !this.shouldHandle(req)\n    ) {\n      return abortHandshake(socket, 400);\n    }\n\n    if (this.options.perMessageDeflate) {\n      const perMessageDeflate = new PerMessageDeflate(\n        this.options.perMessageDeflate,\n        true,\n        this.options.maxPayload\n      );\n\n      try {\n        const offers = parse(req.headers['sec-websocket-extensions']);\n\n        if (offers[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(offers[PerMessageDeflate.extensionName]);\n          extensions[PerMessageDeflate.extensionName] = perMessageDeflate;\n        }\n      } catch (err) {\n        return abortHandshake(socket, 400);\n      }\n    }\n\n    //\n    // Optionally call external client verification handler.\n    //\n    if (this.options.verifyClient) {\n      const info = {\n        origin:\n          req.headers[`${version === 8 ? 'sec-websocket-origin' : 'origin'}`],\n        secure: !!(req.socket.authorized || req.socket.encrypted),\n        req\n      };\n\n      if (this.options.verifyClient.length === 2) {\n        this.options.verifyClient(info, (verified, code, message, headers) => {\n          if (!verified) {\n            return abortHandshake(socket, code || 401, message, headers);\n          }\n\n          this.completeUpgrade(key, extensions, req, socket, head, cb);\n        });\n        return;\n      }\n\n      if (!this.options.verifyClient(info)) return abortHandshake(socket, 401);\n    }\n\n    this.completeUpgrade(key, extensions, req, socket, head, cb);\n  }\n\n  /**\n   * Upgrade the connection to WebSocket.\n   *\n   * @param {String} key The value of the `Sec-WebSocket-Key` header\n   * @param {Object} extensions The accepted extensions\n   * @param {http.IncomingMessage} req The request object\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Function} cb Callback\n   * @throws {Error} If called more than once with the same socket\n   * @private\n   */\n  completeUpgrade(key, extensions, req, socket, head, cb) {\n    //\n    // Destroy the socket if the client has already sent a FIN packet.\n    //\n    if (!socket.readable || !socket.writable) return socket.destroy();\n\n    if (socket[kWebSocket]) {\n      throw new Error(\n        'server.handleUpgrade() was called more than once with the same ' +\n          'socket, possibly due to a misconfiguration'\n      );\n    }\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    const headers = [\n      'HTTP/1.1 101 Switching Protocols',\n      'Upgrade: websocket',\n      'Connection: Upgrade',\n      `Sec-WebSocket-Accept: ${digest}`\n    ];\n\n    const ws = new WebSocket(null);\n    let protocol = req.headers['sec-websocket-protocol'];\n\n    if (protocol) {\n      protocol = protocol.trim().split(/ *, */);\n\n      //\n      // Optionally call external protocol selection handler.\n      //\n      if (this.options.handleProtocols) {\n        protocol = this.options.handleProtocols(protocol, req);\n      } else {\n        protocol = protocol[0];\n      }\n\n      if (protocol) {\n        headers.push(`Sec-WebSocket-Protocol: ${protocol}`);\n        ws._protocol = protocol;\n      }\n    }\n\n    if (extensions[PerMessageDeflate.extensionName]) {\n      const params = extensions[PerMessageDeflate.extensionName].params;\n      const value = format({\n        [PerMessageDeflate.extensionName]: [params]\n      });\n      headers.push(`Sec-WebSocket-Extensions: ${value}`);\n      ws._extensions = extensions;\n    }\n\n    //\n    // Allow external modification/inspection of handshake headers.\n    //\n    this.emit('headers', headers, req);\n\n    socket.write(headers.concat('\\r\\n').join('\\r\\n'));\n    socket.removeListener('error', socketOnError);\n\n    ws.setSocket(socket, head, this.options.maxPayload);\n\n    if (this.clients) {\n      this.clients.add(ws);\n      ws.on('close', () => this.clients.delete(ws));\n    }\n\n    cb(ws, req);\n  }\n}\n\nmodule.exports = WebSocketServer;\n\n/**\n * Add event listeners on an `EventEmitter` using a map of <event, listener>\n * pairs.\n *\n * @param {EventEmitter} server The event emitter\n * @param {Object.<String, Function>} map The listeners to add\n * @return {Function} A function that will remove the added listeners when\n *     called\n * @private\n */\nfunction addListeners(server, map) {\n  for (const event of Object.keys(map)) server.on(event, map[event]);\n\n  return function removeListeners() {\n    for (const event of Object.keys(map)) {\n      server.removeListener(event, map[event]);\n    }\n  };\n}\n\n/**\n * Emit a `'close'` event on an `EventEmitter`.\n *\n * @param {EventEmitter} server The event emitter\n * @private\n */\nfunction emitClose(server) {\n  server.emit('close');\n}\n\n/**\n * Handle premature socket errors.\n *\n * @private\n */\nfunction socketOnError() {\n  this.destroy();\n}\n\n/**\n * Close the connection when preconditions are not fulfilled.\n *\n * @param {net.Socket} socket The socket of the upgrade request\n * @param {Number} code The HTTP response status code\n * @param {String} [message] The HTTP response body\n * @param {Object} [headers] Additional HTTP response headers\n * @private\n */\nfunction abortHandshake(socket, code, message, headers) {\n  if (socket.writable) {\n    message = message || STATUS_CODES[code];\n    headers = {\n      Connection: 'close',\n      'Content-Type': 'text/html',\n      'Content-Length': Buffer.byteLength(message),\n      ...headers\n    };\n\n    socket.write(\n      `HTTP/1.1 ${code} ${STATUS_CODES[code]}\\r\\n` +\n        Object.keys(headers)\n          .map((h) => `${h}: ${headers[h]}`)\n          .join('\\r\\n') +\n        '\\r\\n\\r\\n' +\n        message\n    );\n  }\n\n  socket.removeListener('error', socketOnError);\n  socket.destroy();\n}\n","'use strict';\n\nconst EventEmitter = require('events');\nconst https = require('https');\nconst http = require('http');\nconst net = require('net');\nconst tls = require('tls');\nconst { randomBytes, createHash } = require('crypto');\nconst { URL } = require('url');\n\nconst PerMessageDeflate = require('./permessage-deflate');\nconst Receiver = require('./receiver');\nconst Sender = require('./sender');\nconst {\n  BINARY_TYPES,\n  EMPTY_BUFFER,\n  GUID,\n  kStatusCode,\n  kWebSocket,\n  NOOP\n} = require('./constants');\nconst { addEventListener, removeEventListener } = require('./event-target');\nconst { format, parse } = require('./extension');\nconst { toBuffer } = require('./buffer-util');\n\nconst readyStates = ['CONNECTING', 'OPEN', 'CLOSING', 'CLOSED'];\nconst protocolVersions = [8, 13];\nconst closeTimeout = 30 * 1000;\n\n/**\n * Class representing a WebSocket.\n *\n * @extends EventEmitter\n */\nclass WebSocket extends EventEmitter {\n  /**\n   * Create a new `WebSocket`.\n   *\n   * @param {(String|url.URL)} address The URL to which to connect\n   * @param {(String|String[])} [protocols] The subprotocols\n   * @param {Object} [options] Connection options\n   */\n  constructor(address, protocols, options) {\n    super();\n\n    this._binaryType = BINARY_TYPES[0];\n    this._closeCode = 1006;\n    this._closeFrameReceived = false;\n    this._closeFrameSent = false;\n    this._closeMessage = '';\n    this._closeTimer = null;\n    this._extensions = {};\n    this._protocol = '';\n    this._readyState = WebSocket.CONNECTING;\n    this._receiver = null;\n    this._sender = null;\n    this._socket = null;\n\n    if (address !== null) {\n      this._bufferedAmount = 0;\n      this._isServer = false;\n      this._redirects = 0;\n\n      if (Array.isArray(protocols)) {\n        protocols = protocols.join(', ');\n      } else if (typeof protocols === 'object' && protocols !== null) {\n        options = protocols;\n        protocols = undefined;\n      }\n\n      initAsClient(this, address, protocols, options);\n    } else {\n      this._isServer = true;\n    }\n  }\n\n  /**\n   * This deviates from the WHATWG interface since ws doesn't support the\n   * required default \"blob\" type (instead we define a custom \"nodebuffer\"\n   * type).\n   *\n   * @type {String}\n   */\n  get binaryType() {\n    return this._binaryType;\n  }\n\n  set binaryType(type) {\n    if (!BINARY_TYPES.includes(type)) return;\n\n    this._binaryType = type;\n\n    //\n    // Allow to change `binaryType` on the fly.\n    //\n    if (this._receiver) this._receiver._binaryType = type;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get bufferedAmount() {\n    if (!this._socket) return this._bufferedAmount;\n\n    return this._socket._writableState.length + this._sender._bufferedBytes;\n  }\n\n  /**\n   * @type {String}\n   */\n  get extensions() {\n    return Object.keys(this._extensions).join();\n  }\n\n  /**\n   * @type {String}\n   */\n  get protocol() {\n    return this._protocol;\n  }\n\n  /**\n   * @type {Number}\n   */\n  get readyState() {\n    return this._readyState;\n  }\n\n  /**\n   * @type {String}\n   */\n  get url() {\n    return this._url;\n  }\n\n  /**\n   * Set up the socket and the internal resources.\n   *\n   * @param {net.Socket} socket The network socket between the server and client\n   * @param {Buffer} head The first packet of the upgraded stream\n   * @param {Number} [maxPayload=0] The maximum allowed message size\n   * @private\n   */\n  setSocket(socket, head, maxPayload) {\n    const receiver = new Receiver(\n      this.binaryType,\n      this._extensions,\n      this._isServer,\n      maxPayload\n    );\n\n    this._sender = new Sender(socket, this._extensions);\n    this._receiver = receiver;\n    this._socket = socket;\n\n    receiver[kWebSocket] = this;\n    socket[kWebSocket] = this;\n\n    receiver.on('conclude', receiverOnConclude);\n    receiver.on('drain', receiverOnDrain);\n    receiver.on('error', receiverOnError);\n    receiver.on('message', receiverOnMessage);\n    receiver.on('ping', receiverOnPing);\n    receiver.on('pong', receiverOnPong);\n\n    socket.setTimeout(0);\n    socket.setNoDelay();\n\n    if (head.length > 0) socket.unshift(head);\n\n    socket.on('close', socketOnClose);\n    socket.on('data', socketOnData);\n    socket.on('end', socketOnEnd);\n    socket.on('error', socketOnError);\n\n    this._readyState = WebSocket.OPEN;\n    this.emit('open');\n  }\n\n  /**\n   * Emit the `'close'` event.\n   *\n   * @private\n   */\n  emitClose() {\n    if (!this._socket) {\n      this._readyState = WebSocket.CLOSED;\n      this.emit('close', this._closeCode, this._closeMessage);\n      return;\n    }\n\n    if (this._extensions[PerMessageDeflate.extensionName]) {\n      this._extensions[PerMessageDeflate.extensionName].cleanup();\n    }\n\n    this._receiver.removeAllListeners();\n    this._readyState = WebSocket.CLOSED;\n    this.emit('close', this._closeCode, this._closeMessage);\n  }\n\n  /**\n   * Start a closing handshake.\n   *\n   *          +----------+   +-----------+   +----------+\n   *     - - -|ws.close()|-->|close frame|-->|ws.close()|- - -\n   *    |     +----------+   +-----------+   +----------+     |\n   *          +----------+   +-----------+         |\n   * CLOSING  |ws.close()|<--|close frame|<--+-----+       CLOSING\n   *          +----------+   +-----------+   |\n   *    |           |                        |   +---+        |\n   *                +------------------------+-->|fin| - - - -\n   *    |         +---+                      |   +---+\n   *     - - - - -|fin|<---------------------+\n   *              +---+\n   *\n   * @param {Number} [code] Status code explaining why the connection is closing\n   * @param {String} [data] A string explaining why the connection is closing\n   * @public\n   */\n  close(code, data) {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this.readyState === WebSocket.CLOSING) {\n      if (this._closeFrameSent && this._closeFrameReceived) this._socket.end();\n      return;\n    }\n\n    this._readyState = WebSocket.CLOSING;\n    this._sender.close(code, data, !this._isServer, (err) => {\n      //\n      // This error is handled by the `'error'` listener on the socket. We only\n      // want to know if the close frame has been sent here.\n      //\n      if (err) return;\n\n      this._closeFrameSent = true;\n      if (this._closeFrameReceived) this._socket.end();\n    });\n\n    //\n    // Specify a timeout for the closing handshake to complete.\n    //\n    this._closeTimer = setTimeout(\n      this._socket.destroy.bind(this._socket),\n      closeTimeout\n    );\n  }\n\n  /**\n   * Send a ping.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the ping is sent\n   * @public\n   */\n  ping(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.ping(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a pong.\n   *\n   * @param {*} [data] The data to send\n   * @param {Boolean} [mask] Indicates whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when the pong is sent\n   * @public\n   */\n  pong(data, mask, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof data === 'function') {\n      cb = data;\n      data = mask = undefined;\n    } else if (typeof mask === 'function') {\n      cb = mask;\n      mask = undefined;\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    if (mask === undefined) mask = !this._isServer;\n    this._sender.pong(data || EMPTY_BUFFER, mask, cb);\n  }\n\n  /**\n   * Send a data message.\n   *\n   * @param {*} data The message to send\n   * @param {Object} [options] Options object\n   * @param {Boolean} [options.compress] Specifies whether or not to compress\n   *     `data`\n   * @param {Boolean} [options.binary] Specifies whether `data` is binary or\n   *     text\n   * @param {Boolean} [options.fin=true] Specifies whether the fragment is the\n   *     last one\n   * @param {Boolean} [options.mask] Specifies whether or not to mask `data`\n   * @param {Function} [cb] Callback which is executed when data is written out\n   * @public\n   */\n  send(data, options, cb) {\n    if (this.readyState === WebSocket.CONNECTING) {\n      throw new Error('WebSocket is not open: readyState 0 (CONNECTING)');\n    }\n\n    if (typeof options === 'function') {\n      cb = options;\n      options = {};\n    }\n\n    if (typeof data === 'number') data = data.toString();\n\n    if (this.readyState !== WebSocket.OPEN) {\n      sendAfterClose(this, data, cb);\n      return;\n    }\n\n    const opts = {\n      binary: typeof data !== 'string',\n      mask: !this._isServer,\n      compress: true,\n      fin: true,\n      ...options\n    };\n\n    if (!this._extensions[PerMessageDeflate.extensionName]) {\n      opts.compress = false;\n    }\n\n    this._sender.send(data || EMPTY_BUFFER, opts, cb);\n  }\n\n  /**\n   * Forcibly close the connection.\n   *\n   * @public\n   */\n  terminate() {\n    if (this.readyState === WebSocket.CLOSED) return;\n    if (this.readyState === WebSocket.CONNECTING) {\n      const msg = 'WebSocket was closed before the connection was established';\n      return abortHandshake(this, this._req, msg);\n    }\n\n    if (this._socket) {\n      this._readyState = WebSocket.CLOSING;\n      this._socket.destroy();\n    }\n  }\n}\n\nreadyStates.forEach((readyState, i) => {\n  const descriptor = { enumerable: true, value: i };\n\n  Object.defineProperty(WebSocket.prototype, readyState, descriptor);\n  Object.defineProperty(WebSocket, readyState, descriptor);\n});\n\n[\n  'binaryType',\n  'bufferedAmount',\n  'extensions',\n  'protocol',\n  'readyState',\n  'url'\n].forEach((property) => {\n  Object.defineProperty(WebSocket.prototype, property, { enumerable: true });\n});\n\n//\n// Add the `onopen`, `onerror`, `onclose`, and `onmessage` attributes.\n// See https://html.spec.whatwg.org/multipage/comms.html#the-websocket-interface\n//\n['open', 'error', 'close', 'message'].forEach((method) => {\n  Object.defineProperty(WebSocket.prototype, `on${method}`, {\n    configurable: true,\n    enumerable: true,\n    /**\n     * Return the listener of the event.\n     *\n     * @return {(Function|undefined)} The event listener or `undefined`\n     * @public\n     */\n    get() {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        if (listeners[i]._listener) return listeners[i]._listener;\n      }\n\n      return undefined;\n    },\n    /**\n     * Add a listener for the event.\n     *\n     * @param {Function} listener The listener to add\n     * @public\n     */\n    set(listener) {\n      const listeners = this.listeners(method);\n      for (let i = 0; i < listeners.length; i++) {\n        //\n        // Remove only the listeners added via `addEventListener`.\n        //\n        if (listeners[i]._listener) this.removeListener(method, listeners[i]);\n      }\n      this.addEventListener(method, listener);\n    }\n  });\n});\n\nWebSocket.prototype.addEventListener = addEventListener;\nWebSocket.prototype.removeEventListener = removeEventListener;\n\nmodule.exports = WebSocket;\n\n/**\n * Initialize a WebSocket client.\n *\n * @param {WebSocket} websocket The client to initialize\n * @param {(String|url.URL)} address The URL to which to connect\n * @param {String} [protocols] The subprotocols\n * @param {Object} [options] Connection options\n * @param {(Boolean|Object)} [options.perMessageDeflate=true] Enable/disable\n *     permessage-deflate\n * @param {Number} [options.handshakeTimeout] Timeout in milliseconds for the\n *     handshake request\n * @param {Number} [options.protocolVersion=13] Value of the\n *     `Sec-WebSocket-Version` header\n * @param {String} [options.origin] Value of the `Origin` or\n *     `Sec-WebSocket-Origin` header\n * @param {Number} [options.maxPayload=104857600] The maximum allowed message\n *     size\n * @param {Boolean} [options.followRedirects=false] Whether or not to follow\n *     redirects\n * @param {Number} [options.maxRedirects=10] The maximum number of redirects\n *     allowed\n * @private\n */\nfunction initAsClient(websocket, address, protocols, options) {\n  const opts = {\n    protocolVersion: protocolVersions[1],\n    maxPayload: 100 * 1024 * 1024,\n    perMessageDeflate: true,\n    followRedirects: false,\n    maxRedirects: 10,\n    ...options,\n    createConnection: undefined,\n    socketPath: undefined,\n    hostname: undefined,\n    protocol: undefined,\n    timeout: undefined,\n    method: undefined,\n    host: undefined,\n    path: undefined,\n    port: undefined\n  };\n\n  if (!protocolVersions.includes(opts.protocolVersion)) {\n    throw new RangeError(\n      `Unsupported protocol version: ${opts.protocolVersion} ` +\n        `(supported versions: ${protocolVersions.join(', ')})`\n    );\n  }\n\n  let parsedUrl;\n\n  if (address instanceof URL) {\n    parsedUrl = address;\n    websocket._url = address.href;\n  } else {\n    parsedUrl = new URL(address);\n    websocket._url = address;\n  }\n\n  const isUnixSocket = parsedUrl.protocol === 'ws+unix:';\n\n  if (!parsedUrl.host && (!isUnixSocket || !parsedUrl.pathname)) {\n    throw new Error(`Invalid URL: ${websocket.url}`);\n  }\n\n  const isSecure =\n    parsedUrl.protocol === 'wss:' || parsedUrl.protocol === 'https:';\n  const defaultPort = isSecure ? 443 : 80;\n  const key = randomBytes(16).toString('base64');\n  const get = isSecure ? https.get : http.get;\n  let perMessageDeflate;\n\n  opts.createConnection = isSecure ? tlsConnect : netConnect;\n  opts.defaultPort = opts.defaultPort || defaultPort;\n  opts.port = parsedUrl.port || defaultPort;\n  opts.host = parsedUrl.hostname.startsWith('[')\n    ? parsedUrl.hostname.slice(1, -1)\n    : parsedUrl.hostname;\n  opts.headers = {\n    'Sec-WebSocket-Version': opts.protocolVersion,\n    'Sec-WebSocket-Key': key,\n    Connection: 'Upgrade',\n    Upgrade: 'websocket',\n    ...opts.headers\n  };\n  opts.path = parsedUrl.pathname + parsedUrl.search;\n  opts.timeout = opts.handshakeTimeout;\n\n  if (opts.perMessageDeflate) {\n    perMessageDeflate = new PerMessageDeflate(\n      opts.perMessageDeflate !== true ? opts.perMessageDeflate : {},\n      false,\n      opts.maxPayload\n    );\n    opts.headers['Sec-WebSocket-Extensions'] = format({\n      [PerMessageDeflate.extensionName]: perMessageDeflate.offer()\n    });\n  }\n  if (protocols) {\n    opts.headers['Sec-WebSocket-Protocol'] = protocols;\n  }\n  if (opts.origin) {\n    if (opts.protocolVersion < 13) {\n      opts.headers['Sec-WebSocket-Origin'] = opts.origin;\n    } else {\n      opts.headers.Origin = opts.origin;\n    }\n  }\n  if (parsedUrl.username || parsedUrl.password) {\n    opts.auth = `${parsedUrl.username}:${parsedUrl.password}`;\n  }\n\n  if (isUnixSocket) {\n    const parts = opts.path.split(':');\n\n    opts.socketPath = parts[0];\n    opts.path = parts[1];\n  }\n\n  let req = (websocket._req = get(opts));\n\n  if (opts.timeout) {\n    req.on('timeout', () => {\n      abortHandshake(websocket, req, 'Opening handshake has timed out');\n    });\n  }\n\n  req.on('error', (err) => {\n    if (req === null || req.aborted) return;\n\n    req = websocket._req = null;\n    websocket._readyState = WebSocket.CLOSING;\n    websocket.emit('error', err);\n    websocket.emitClose();\n  });\n\n  req.on('response', (res) => {\n    const location = res.headers.location;\n    const statusCode = res.statusCode;\n\n    if (\n      location &&\n      opts.followRedirects &&\n      statusCode >= 300 &&\n      statusCode < 400\n    ) {\n      if (++websocket._redirects > opts.maxRedirects) {\n        abortHandshake(websocket, req, 'Maximum redirects exceeded');\n        return;\n      }\n\n      req.abort();\n\n      const addr = new URL(location, address);\n\n      initAsClient(websocket, addr, protocols, options);\n    } else if (!websocket.emit('unexpected-response', req, res)) {\n      abortHandshake(\n        websocket,\n        req,\n        `Unexpected server response: ${res.statusCode}`\n      );\n    }\n  });\n\n  req.on('upgrade', (res, socket, head) => {\n    websocket.emit('upgrade', res);\n\n    //\n    // The user may have closed the connection from a listener of the `upgrade`\n    // event.\n    //\n    if (websocket.readyState !== WebSocket.CONNECTING) return;\n\n    req = websocket._req = null;\n\n    const digest = createHash('sha1')\n      .update(key + GUID)\n      .digest('base64');\n\n    if (res.headers['sec-websocket-accept'] !== digest) {\n      abortHandshake(websocket, socket, 'Invalid Sec-WebSocket-Accept header');\n      return;\n    }\n\n    const serverProt = res.headers['sec-websocket-protocol'];\n    const protList = (protocols || '').split(/, */);\n    let protError;\n\n    if (!protocols && serverProt) {\n      protError = 'Server sent a subprotocol but none was requested';\n    } else if (protocols && !serverProt) {\n      protError = 'Server sent no subprotocol';\n    } else if (serverProt && !protList.includes(serverProt)) {\n      protError = 'Server sent an invalid subprotocol';\n    }\n\n    if (protError) {\n      abortHandshake(websocket, socket, protError);\n      return;\n    }\n\n    if (serverProt) websocket._protocol = serverProt;\n\n    if (perMessageDeflate) {\n      try {\n        const extensions = parse(res.headers['sec-websocket-extensions']);\n\n        if (extensions[PerMessageDeflate.extensionName]) {\n          perMessageDeflate.accept(extensions[PerMessageDeflate.extensionName]);\n          websocket._extensions[\n            PerMessageDeflate.extensionName\n          ] = perMessageDeflate;\n        }\n      } catch (err) {\n        abortHandshake(\n          websocket,\n          socket,\n          'Invalid Sec-WebSocket-Extensions header'\n        );\n        return;\n      }\n    }\n\n    websocket.setSocket(socket, head, opts.maxPayload);\n  });\n}\n\n/**\n * Create a `net.Socket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {net.Socket} The newly created socket used to start the connection\n * @private\n */\nfunction netConnect(options) {\n  options.path = options.socketPath;\n  return net.connect(options);\n}\n\n/**\n * Create a `tls.TLSSocket` and initiate a connection.\n *\n * @param {Object} options Connection options\n * @return {tls.TLSSocket} The newly created socket used to start the connection\n * @private\n */\nfunction tlsConnect(options) {\n  options.path = undefined;\n\n  if (!options.servername && options.servername !== '') {\n    options.servername = net.isIP(options.host) ? '' : options.host;\n  }\n\n  return tls.connect(options);\n}\n\n/**\n * Abort the handshake and emit an error.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {(http.ClientRequest|net.Socket)} stream The request to abort or the\n *     socket to destroy\n * @param {String} message The error message\n * @private\n */\nfunction abortHandshake(websocket, stream, message) {\n  websocket._readyState = WebSocket.CLOSING;\n\n  const err = new Error(message);\n  Error.captureStackTrace(err, abortHandshake);\n\n  if (stream.setHeader) {\n    stream.abort();\n\n    if (stream.socket && !stream.socket.destroyed) {\n      //\n      // On Node.js >= 14.3.0 `request.abort()` does not destroy the socket if\n      // called after the request completed. See\n      // https://github.com/websockets/ws/issues/1869.\n      //\n      stream.socket.destroy();\n    }\n\n    stream.once('abort', websocket.emitClose.bind(websocket));\n    websocket.emit('error', err);\n  } else {\n    stream.destroy(err);\n    stream.once('error', websocket.emit.bind(websocket, 'error'));\n    stream.once('close', websocket.emitClose.bind(websocket));\n  }\n}\n\n/**\n * Handle cases where the `ping()`, `pong()`, or `send()` methods are called\n * when the `readyState` attribute is `CLOSING` or `CLOSED`.\n *\n * @param {WebSocket} websocket The WebSocket instance\n * @param {*} [data] The data to send\n * @param {Function} [cb] Callback\n * @private\n */\nfunction sendAfterClose(websocket, data, cb) {\n  if (data) {\n    const length = toBuffer(data).length;\n\n    //\n    // The `_bufferedAmount` property is used only when the peer is a client and\n    // the opening handshake fails. Under these circumstances, in fact, the\n    // `setSocket()` method is not called, so the `_socket` and `_sender`\n    // properties are set to `null`.\n    //\n    if (websocket._socket) websocket._sender._bufferedBytes += length;\n    else websocket._bufferedAmount += length;\n  }\n\n  if (cb) {\n    const err = new Error(\n      `WebSocket is not open: readyState ${websocket.readyState} ` +\n        `(${readyStates[websocket.readyState]})`\n    );\n    cb(err);\n  }\n}\n\n/**\n * The listener of the `Receiver` `'conclude'` event.\n *\n * @param {Number} code The status code\n * @param {String} reason The reason for closing\n * @private\n */\nfunction receiverOnConclude(code, reason) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n  websocket._socket.resume();\n\n  websocket._closeFrameReceived = true;\n  websocket._closeMessage = reason;\n  websocket._closeCode = code;\n\n  if (code === 1005) websocket.close();\n  else websocket.close(code, reason);\n}\n\n/**\n * The listener of the `Receiver` `'drain'` event.\n *\n * @private\n */\nfunction receiverOnDrain() {\n  this[kWebSocket]._socket.resume();\n}\n\n/**\n * The listener of the `Receiver` `'error'` event.\n *\n * @param {(RangeError|Error)} err The emitted error\n * @private\n */\nfunction receiverOnError(err) {\n  const websocket = this[kWebSocket];\n\n  websocket._socket.removeListener('data', socketOnData);\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._closeCode = err[kStatusCode];\n  websocket.emit('error', err);\n  websocket._socket.destroy();\n}\n\n/**\n * The listener of the `Receiver` `'finish'` event.\n *\n * @private\n */\nfunction receiverOnFinish() {\n  this[kWebSocket].emitClose();\n}\n\n/**\n * The listener of the `Receiver` `'message'` event.\n *\n * @param {(String|Buffer|ArrayBuffer|Buffer[])} data The message\n * @private\n */\nfunction receiverOnMessage(data) {\n  this[kWebSocket].emit('message', data);\n}\n\n/**\n * The listener of the `Receiver` `'ping'` event.\n *\n * @param {Buffer} data The data included in the ping frame\n * @private\n */\nfunction receiverOnPing(data) {\n  const websocket = this[kWebSocket];\n\n  websocket.pong(data, !websocket._isServer, NOOP);\n  websocket.emit('ping', data);\n}\n\n/**\n * The listener of the `Receiver` `'pong'` event.\n *\n * @param {Buffer} data The data included in the pong frame\n * @private\n */\nfunction receiverOnPong(data) {\n  this[kWebSocket].emit('pong', data);\n}\n\n/**\n * The listener of the `net.Socket` `'close'` event.\n *\n * @private\n */\nfunction socketOnClose() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('close', socketOnClose);\n  this.removeListener('end', socketOnEnd);\n\n  websocket._readyState = WebSocket.CLOSING;\n\n  //\n  // The close frame might not have been received or the `'end'` event emitted,\n  // for example, if the socket was destroyed due to an error. Ensure that the\n  // `receiver` stream is closed after writing any remaining buffered data to\n  // it. If the readable side of the socket is in flowing mode then there is no\n  // buffered data as everything has been already written and `readable.read()`\n  // will return `null`. If instead, the socket is paused, any possible buffered\n  // data will be read as a single chunk and emitted synchronously in a single\n  // `'data'` event.\n  //\n  websocket._socket.read();\n  websocket._receiver.end();\n\n  this.removeListener('data', socketOnData);\n  this[kWebSocket] = undefined;\n\n  clearTimeout(websocket._closeTimer);\n\n  if (\n    websocket._receiver._writableState.finished ||\n    websocket._receiver._writableState.errorEmitted\n  ) {\n    websocket.emitClose();\n  } else {\n    websocket._receiver.on('error', receiverOnFinish);\n    websocket._receiver.on('finish', receiverOnFinish);\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'data'` event.\n *\n * @param {Buffer} chunk A chunk of data\n * @private\n */\nfunction socketOnData(chunk) {\n  if (!this[kWebSocket]._receiver.write(chunk)) {\n    this.pause();\n  }\n}\n\n/**\n * The listener of the `net.Socket` `'end'` event.\n *\n * @private\n */\nfunction socketOnEnd() {\n  const websocket = this[kWebSocket];\n\n  websocket._readyState = WebSocket.CLOSING;\n  websocket._receiver.end();\n  this.end();\n}\n\n/**\n * The listener of the `net.Socket` `'error'` event.\n *\n * @private\n */\nfunction socketOnError() {\n  const websocket = this[kWebSocket];\n\n  this.removeListener('error', socketOnError);\n  this.on('error', NOOP);\n\n  if (websocket) {\n    websocket._readyState = WebSocket.CLOSING;\n    this.destroy();\n  }\n}\n","module.exports = require(\"child_process\");;","module.exports = require(\"crypto\");;","module.exports = require(\"events\");;","module.exports = require(\"fs\");;","module.exports = require(\"http\");;","module.exports = require(\"https\");;","module.exports = require(\"net\");;","module.exports = require(\"os\");;","module.exports = require(\"path\");;","module.exports = require(\"stream\");;","module.exports = require(\"tls\");;","module.exports = require(\"url\");;","module.exports = require(\"vscode\");;","module.exports = require(\"zlib\");;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(810);\n"],"sourceRoot":""}